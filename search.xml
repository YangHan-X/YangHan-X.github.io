<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title></title>
      <link href="/2024/09/06/LINUX_dpkg/"/>
      <url>/2024/09/06/LINUX_dpkg/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/lightgallery.min.css" /><div class=".article-gallery"><h2 id="dpkg简介"><a href="#dpkg简介" class="headerlink" title="dpkg简介"></a>dpkg简介</h2><p><code>dpkg</code>（Debian Package Manager），是<code>Debian</code>系统及其衍生系统（如<code>Ubuntu</code>）中最基本的<code>软件包管理工具</code>。</p><p><code>dpkg</code>允许用户以命令行的形式，去安装、删除、查询、更新软件包，以及处理软件包的依赖关系。</p><p><code>dpkg</code>直接与<code>Debian</code>系统中的<code>.deb</code>软件包格式交互，提供了对软件包内容的底层访问。</p><p>参考资料：</p><p>（1）<a href="https://www.dpkg.org/">https://www.dpkg.org/</a></p><p>（2）<a href="https://wiki.debian.org/dpkg">https://wiki.debian.org/dpkg</a></p><h2 id="dpkg语法"><a href="#dpkg语法" class="headerlink" title="dpkg语法"></a>dpkg语法</h2><ul><li><p>安装（更新，重装）软件包</p><p>安装软件包或更新软件包，需要指定软件包的路径。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装一个软件包</span></span><br><span class="line">sudo dpkg -i appName.deb</span><br><span class="line"><span class="comment"># 安装多个软件包</span></span><br><span class="line">sudo dpkg -i appName0.deb appName1.deb appName2.deb</span><br></pre></td></tr></table></figure><p>强制安装软件包</p><p>在部分场景下，系统会因为软件包的依赖关系而拒绝安装软件包，若确定软件包的依赖满足，可以通过该选择强制安装软件包。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dpkg --force-depends -i appName.deb</span><br></pre></td></tr></table></figure></li><li><p>删除已安装的软件包</p><p>删除一个已安装的软件包，只需要提供软件包名称。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo dpkg -r appName</span><br><span class="line">sudo dpkg --romove appName</span><br></pre></td></tr></table></figure></li><li><p>查询软件包信息</p><ul><li><p>查询已安装的软件包列表</p><p>该命令会显示所有已安装软件包的名称、版本号和描述信息。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpkg -l</span><br></pre></td></tr></table></figure></li><li><p>查询已安装的指定软件包信息</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpkg -s appName</span><br></pre></td></tr></table></figure></li><li><p>查询已安装的指定软件包结构</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dpkg -L appName</span><br><span class="line">dpkg --listfiles appName</span><br></pre></td></tr></table></figure></li></ul></li><li><p>查询软件包的依赖关系</p><p><code>dpkg</code>自身不直接解决依赖关系的问题，但其提供了检查和处理依赖关系的一些选项，来查看是否满足依赖关系。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpkg -c appName.deb</span><br></pre></td></tr></table></figure></li><li><p>验证软件包完整性</p><p><code>--verify</code>选项可以验证软件包的完整性，判断软件包是否被修改或被损坏。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dpkg --verify appName</span><br></pre></td></tr></table></figure></li><li><p>修复损坏的软件包</p><p>若系统中的软件包损坏或配置错误，可以使用<code>--configure</code>来尝试配置那些未配置的软件包。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dpkg --configure -a</span><br></pre></td></tr></table></figure></li><li><p>清理未使用的软件包文件</p><p>当系统安装卸载了很多软件，可能会积累一些已被删除或不再需要的软件包文件或配置文件，可以使用<code>--purge</code>清理这些文件。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dpkg --purge appName</span><br></pre></td></tr></table></figure></li></ul></div><script src="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/js/lightgallery.min.js"></script><script>if("undefined"!=typeof lightGallery) {        var options1 = {            selector: '.gallery-item'        };        lightGallery(document.getElementsByClassName('.article-gallery')[0], options1);        }</script>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/08/28/LINUX_%E7%9B%91%E6%B5%8B%E6%89%93%E5%8D%B0%E6%9C%BA%E8%A1%8C%E4%B8%BA/"/>
      <url>/2024/08/28/LINUX_%E7%9B%91%E6%B5%8B%E6%89%93%E5%8D%B0%E6%9C%BA%E8%A1%8C%E4%B8%BA/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/lightgallery.min.css" /><div class=".article-gallery"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在Linux中，要对打印机执行一些操作，通常是使用cups。</p><p>使用编程指令时，需要一部分数据，如：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 要执行删除一台打印机的操作，需要传递 ‘printer-uri’ 参数</span><br><span class="line"><span class="type">ipp_t</span> *request = <span class="built_in">ippNewRequest</span>(IPP_OP_CUPS_DELETE_PRINTER);</span><br><span class="line"><span class="built_in">ippAddString</span>(request, IPP_TAG_OPERATION, IPP_TAG_URI, <span class="string">&quot;printer-uri&quot;</span>, <span class="literal">nullptr</span>, uri);</span><br></pre></td></tr></table></figure><p>这些参数可以在DBus获取（未配置驱动的打印机不会发出信号）。CUPS通过DBus发送了相关的信号，因此可以这样获取这些参数：</p><ul><li><p>使用<code>dbus-monitor</code>工具来监测系统中关于CPUS的信号；</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dbus-monitor --system &quot;type=&#x27;signal&#x27;,interface=&#x27;org.cups.cupsd.Notifier&#x27;&quot;</span><br></pre></td></tr></table></figure><p>例如，当我们打印时，会收到一个信号：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line">  ```</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">```cpp</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">include <span class="string">&quot;PrinterMonitor.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">PrinterMonitor::PrinterMonitor(const char* prtName, QObject *parent) : QThread(parent)</span><br><span class="line">&#123;</span><br><span class="line">    m_prtName = prtName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void PrinterMonitor::run()</span><br><span class="line">&#123;</span><br><span class="line">    while (true)</span><br><span class="line">    &#123;</span><br><span class="line">        disableOtherPrinters();</span><br><span class="line">        QThread::sleep(10);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void PrinterMonitor::disableOtherPrinters()</span><br><span class="line">&#123;</span><br><span class="line">    // Get the list of all printers</span><br><span class="line">    cups_dest_t *dests = nullptr;</span><br><span class="line">    int num_printers = cupsGetDests(&amp;dests);</span><br><span class="line"></span><br><span class="line">    if (num_printers == 0)</span><br><span class="line">    &#123;</span><br><span class="line">        qDebug() &lt;&lt; &quot;No printers found.&quot;;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    cups_dest_t *dest = nullptr;</span><br><span class="line">    const char* uri = nullptr;</span><br><span class="line">    for (int i = 0; i &lt; num_printers; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        dest = &amp;dests[i];</span><br><span class="line">        uri = cupsGetOption(&quot;printer-uri-supported&quot;, dest-&gt;num_options, dest-&gt;options);</span><br><span class="line">        qDebug() &lt;&lt; &quot;Checking printer:&quot; &lt;&lt; dest-&gt;name &lt;&lt; uri;</span><br><span class="line">        // Check if the printer is enabled (state != IPP_PRINTER_STOPPED)</span><br><span class="line">        ipp_t *request = ippNewRequest(IPP_OP_GET_PRINTER_ATTRIBUTES);</span><br><span class="line">        ippAddString(request, IPP_TAG_OPERATION, IPP_TAG_URI, &quot;printer-uri&quot;, nullptr, uri);</span><br><span class="line">        const char *requested_attributes[] = &#123; &quot;printer-is-accepting-jobs&quot;, &quot;printer-state-reasons&quot; &#125;;</span><br><span class="line">            ippAddStrings(request, IPP_TAG_OPERATION, IPP_TAG_KEYWORD, &quot;requested-attributes&quot;, 2, nullptr, requested_attributes);</span><br><span class="line">            http_t *http = httpConnect2(cupsServer(), ippPort(), nullptr, AF_UNSPEC, cupsEncryption(), 1, 30000, nullptr);</span><br><span class="line">        ipp_t *response = cupsDoRequest(http, request, &quot;/&quot;);</span><br><span class="line"></span><br><span class="line">        if (response != nullptr)</span><br><span class="line">        &#123;</span><br><span class="line">            printIppResponseAttributes(response);</span><br><span class="line">//           ipp_attribute_t *attr = ippFindAttribute(response, &quot;printer-state&quot;, IPP_TAG_ENUM);</span><br><span class="line">//           if (attr != nullptr) &#123;</span><br><span class="line">//               int printerState = ippGetInteger(attr, 0);</span><br><span class="line">//               if (printerState != IPP_PRINTER_STOPPED)</span><br><span class="line">//               &#123;</span><br><span class="line">//                   qDebug() &lt;&lt; &quot;Printer is enabled. Disabling:&quot; &lt;&lt; printerState &lt;&lt; dest-&gt;name;</span><br><span class="line"></span><br><span class="line">//                   // Disable the printer</span><br><span class="line">//                   ipp_t *disableRequest = ippNewRequest(IPP_OP_DISABLE_PRINTER);</span><br><span class="line">//                   ippAddString(disableRequest, IPP_TAG_OPERATION, IPP_TAG_URI, &quot;printer-uri&quot;, nullptr, uri);</span><br><span class="line">//                   ipp_t *disableResponse = cupsDoRequest(http, disableRequest, &quot;/&quot;);</span><br><span class="line"></span><br><span class="line">//                   if (cupsLastError() &gt; IPP_OK_CONFLICT) &#123;</span><br><span class="line">//                       qDebug() &lt;&lt; &quot;Failed to disable printer:&quot; &lt;&lt; dest-&gt;name &lt;&lt; &quot;Error:&quot; &lt;&lt; cupsLastErrorString();</span><br><span class="line">//                   &#125; else &#123;</span><br><span class="line">//                       qDebug() &lt;&lt; &quot;Printer disabled successfully:&quot; &lt;&lt; dest-&gt;name;</span><br><span class="line">//                   &#125;</span><br><span class="line"></span><br><span class="line">//                   ippDelete(disableResponse);</span><br><span class="line">//               &#125; else &#123;</span><br><span class="line">//                   qDebug() &lt;&lt; &quot;Printer is already disabled:&quot; &lt;&lt; dest-&gt;name;</span><br><span class="line">//               &#125;</span><br><span class="line">//           &#125; else &#123;</span><br><span class="line">//               qDebug() &lt;&lt; &quot;Failed to get printer state for:&quot; &lt;&lt; dest-&gt;name;</span><br><span class="line">//           &#125;</span><br><span class="line">       &#125; else &#123;</span><br><span class="line">           qDebug() &lt;&lt; &quot;Failed to get printer state for:&quot; &lt;&lt; dest-&gt;name;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">        ippDelete(response);</span><br><span class="line">        httpClose(http);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    cupsFreeDests(num_printers, dests);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void PrinterMonitor::printIppResponseAttributes(ipp_t *response)</span><br><span class="line">&#123;</span><br><span class="line">    if (!response) &#123;</span><br><span class="line">           qDebug() &lt;&lt; &quot;No response received.&quot;;</span><br><span class="line">           return;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       // Start at the first attribute</span><br><span class="line">       ipp_attribute_t *attr = ippFirstAttribute(response);</span><br><span class="line"></span><br><span class="line">       // Loop through all attributes</span><br><span class="line">       while (attr != nullptr) &#123;</span><br><span class="line">           // Print attribute name and type</span><br><span class="line">           qDebug() &lt;&lt; &quot;Attribute Name:&quot; &lt;&lt; ippGetName(attr);</span><br><span class="line">           qDebug() &lt;&lt; &quot;Attribute Type:&quot; &lt;&lt; ippTagString(ippGetValueTag(attr));</span><br><span class="line"></span><br><span class="line">           // Print the attribute value(s) based on its type</span><br><span class="line">           switch (ippGetValueTag(attr)) &#123;</span><br><span class="line">               case IPP_TAG_INTEGER:</span><br><span class="line">               case IPP_TAG_ENUM:</span><br><span class="line">                   qDebug() &lt;&lt; &quot;Value:&quot; &lt;&lt; ippGetInteger(attr, 0);</span><br><span class="line">                   break;</span><br><span class="line">               case IPP_TAG_BOOLEAN:</span><br><span class="line">                   qDebug() &lt;&lt; &quot;Value:&quot; &lt;&lt; ippGetBoolean(attr, 0);</span><br><span class="line">                   break;</span><br><span class="line">               case IPP_TAG_STRING:</span><br><span class="line">               case IPP_TAG_TEXT:</span><br><span class="line">               case IPP_TAG_NAME:</span><br><span class="line">               case IPP_TAG_KEYWORD:</span><br><span class="line">               case IPP_TAG_URI:</span><br><span class="line">               case IPP_TAG_URISCHEME:</span><br><span class="line">               case IPP_TAG_CHARSET:</span><br><span class="line">               case IPP_TAG_LANGUAGE:</span><br><span class="line">               case IPP_TAG_MIMETYPE:</span><br><span class="line">                   qDebug() &lt;&lt; &quot;Value:&quot; &lt;&lt; ippGetString(attr, 0, nullptr);</span><br><span class="line">                   break;</span><br><span class="line">               case IPP_TAG_RANGE:</span><br><span class="line">                   qDebug() &lt;&lt; &quot;Value Range:&quot; &lt;&lt; ippGetRange(attr, 0, nullptr) &lt;&lt; &quot;-&quot; &lt;&lt; ippGetRange(attr, 0, nullptr);</span><br><span class="line">                   break;</span><br><span class="line">               case IPP_TAG_RESOLUTION: &#123;</span><br><span class="line">                   int xres, yres;</span><br><span class="line">                   ipp_res_t units;</span><br><span class="line">                   xres = ippGetResolution(attr, 0, &amp;yres, &amp;units);</span><br><span class="line">                   qDebug() &lt;&lt; &quot;Resolution:&quot; &lt;&lt; xres &lt;&lt; &quot;x&quot; &lt;&lt; yres &lt;&lt; (units == IPP_RES_PER_INCH ? &quot;dpi&quot; : &quot;dpcm&quot;);</span><br><span class="line">                   break;</span><br><span class="line">               &#125;</span><br><span class="line">               case IPP_TAG_DATE: &#123;</span><br><span class="line">                   const ipp_uchar_t *date = ippGetDate(attr, 0);</span><br><span class="line">                   qDebug() &lt;&lt; &quot;Date:&quot; &lt;&lt; date;</span><br><span class="line">                   break;</span><br><span class="line">               &#125;</span><br><span class="line">               // Add more cases as needed for different IPP tag types.</span><br><span class="line">               default:</span><br><span class="line">                   qDebug() &lt;&lt; &quot;Unsupported IPP tag type:&quot; &lt;&lt; ippTagString(ippGetValueTag(attr));</span><br><span class="line">                   break;</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           // Move to the next attribute</span><br><span class="line">           attr = ippNextAttribute(response);</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul></div><script src="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/js/lightgallery.min.js"></script><script>if("undefined"!=typeof lightGallery) {        var options1 = {            selector: '.gallery-item'        };        lightGallery(document.getElementsByClassName('.article-gallery')[0], options1);        }</script>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>STL简介</title>
      <link href="/2024/08/13/STL%E7%AE%80%E4%BB%8B/"/>
      <url>/2024/08/13/STL%E7%AE%80%E4%BB%8B/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/lightgallery.min.css" /><div class=".article-gallery"><h2 id="STL"><a href="#STL" class="headerlink" title="STL"></a>STL</h2><p><code>STL</code>（Standard Template Library，标准模板库），是一个C++的软件库。</p><p><code>STL</code>是一套数据结构和算法的标准，旨在降低耦合，提高独立性和交互操作性，提升复用性。</p><p><code>STL</code>的价值主要体现在两个方面：</p><ul><li><p>基本价值：带来一套极具实用加指的零部件，以及一个整合的组织。</p></li><li><p>创新价值：以<code>泛型思维</code>（Generic paradigm）为基础的、系统化的、条例分明的”软件组件分类学”。</p><blockquote><p>也就是说<code>STL</code>是一个抽象概念库。</p></blockquote></li></ul><h2 id="STL六大组件"><a href="#STL六大组件" class="headerlink" title="STL六大组件"></a>STL六大组件</h2><p><code>STL</code>提供了六大组件，组件与组件之间可以组合套用。分别为：</p><ul><li><p>容器（containers）</p><p>提供各种数据结构用来存放数据，如vector、list、enque、deque、set、map等。</p><p>在底层实现上，<code>STL容器</code>是一种类模板。</p></li><li><p>算法（algorithms）</p><p>提供各种算法，如sort()、search()、copy()等。</p><p>在底层实现上，<code>STL算法</code>是一种函数模板。</p></li><li><p>迭代器（iterators）</p><p>作为容器与算法之间的胶合剂，即所谓“泛型指针”，其对指针相关操作（如operator*、operator-&gt;、operator++、operator-等）进行了重载。</p><p>在底层实现上，<code>迭代器</code>是一种类模板，</p></li><li><p>仿函数（functors）</p><p>行为类似函数，可以作用算法的某种策略。</p><p>在底层实现上，仿函数是一种重载了<code>operator()</code>的类或类模板，一般函数指针可视为侠义的仿函数。</p></li><li><p>适配器（adapters）</p><p>用以修饰容器&#x2F;仿函数&#x2F;迭代器接口。</p></li><li><p>配置器（allocators）</p><p>负责配置和管理空间。</p><p>在底层实现上，配置器是一个对空间进行动态配置、管理和释放的类模板。</p></li></ul><p>在<code>C++</code>标准中，<code>STL</code>被组织为<code>13</code>个文件，分别归纳在<code>算法</code>、<code>容器</code>和<code>迭代器</code>中。</p><h3 id="算法"><a href="#算法" class="headerlink" title="算法"></a>算法</h3><p>算法部分主要包括3个头文件。</p><table><thead><tr><th>头文件</th><th>描述</th></tr></thead><tbody><tr><td><code>&lt;algorithm&gt;</code></td><td>STL中最大的一个头文件，由许多模板函数组成，每个模板函数相对独立。<br />功能范围：比较、交换、查找、遍历、复制、修改、移除、反转、排序、合并等。</td></tr><tr><td><code>&lt;numeric&gt;</code></td><td>体积较小。包括几个对序列进行简单数学运算的模板函数。</td></tr><tr><td><code>&lt;functional&gt;</code></td><td>定义了一些模板类，用以声明函数对象。</td></tr></tbody></table><h3 id="容器"><a href="#容器" class="headerlink" title="容器"></a>容器</h3><p>容器部分包括7个头文件。</p><table><thead><tr><th>头文件</th><th>描述</th></tr></thead><tbody><tr><td><code>&lt;vector&gt;</code></td><td>动态数组。有内存管理机制，随机访问较快，对于插入和删除操作，可动态调整所占用的内存空间</td></tr><tr><td><code>&lt;list&gt;</code></td><td>双向链表。非连续空间，允许快速插入和删除操作，但随机访问较慢</td></tr><tr><td><code>&lt;queue&gt;</code></td><td></td></tr><tr><td><code>&lt;deque&gt;</code></td><td>队列容器。与vector作用一致，还支持从首端插入数据</td></tr><tr><td><code>&lt;set&gt;</code></td><td>集合容器。有序容器，默认自动排序，无法插入相同的元素</td></tr><tr><td><code>&lt;map&gt;</code></td><td>键值对容器。一个key对应一个value，会根据key进行自动排序</td></tr><tr><td><code>&lt;stack&gt;</code></td><td></td></tr></tbody></table><h3 id="迭代器"><a href="#迭代器" class="headerlink" title="迭代器"></a>迭代器</h3><p>迭代器部分包括3个头文件。</p><table><thead><tr><th>头文件</th><th>描述</th></tr></thead><tbody><tr><td><code>&lt;utility&gt;</code></td><td></td></tr><tr><td><code>&lt;iterator&gt;</code></td><td></td></tr><tr><td><code>&lt;memory&gt;</code></td><td></td></tr></tbody></table></div><script src="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/js/lightgallery.min.js"></script><script>if("undefined"!=typeof lightGallery) {        var options1 = {            selector: '.gallery-item'        };        lightGallery(document.getElementsByClassName('.article-gallery')[0], options1);        }</script>]]></content>
      
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> STL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>QT-QTableWidget基本使用</title>
      <link href="/2024/08/07/QT-QTableWidget%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/"/>
      <url>/2024/08/07/QT-QTableWidget%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/lightgallery.min.css" /><div class=".article-gallery"><h3 id="设置水平表头"><a href="#设置水平表头" class="headerlink" title="设置水平表头"></a>设置水平表头</h3><p>设置水平表头之前，需要先设置列数，再设置表头。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">QTableWidget *table = <span class="keyword">new</span> <span class="built_in">QTableWidget</span>(<span class="keyword">this</span>);</span><br><span class="line">QStringList headerList;</span><br><span class="line">headerList &lt;&lt; <span class="string">&quot;编号&quot;</span> &lt;&lt; <span class="string">&quot;姓名&quot;</span> &lt;&lt; <span class="string">&quot;性别&quot;</span> &lt;&lt; <span class="string">&quot;年龄&quot;</span>;</span><br><span class="line">table-&gt;<span class="built_in">setColumnCount</span>(headerList.<span class="built_in">size</span>());</span><br><span class="line">table-&gt;<span class="built_in">setHorizonalHeaderLabels</span>(headerList);</span><br></pre></td></tr></table></figure><p>运行后，会发现最后一列之后，还有空白未分配。</p><h3 id="调整列宽"><a href="#调整列宽" class="headerlink" title="调整列宽"></a>调整列宽</h3><p>QT提供了一个枚举<code>enum ResizeMode</code>，来设置列宽模式：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">ResizeMode</span></span><br><span class="line">&#123;</span><br><span class="line">    Interactive, <span class="comment">// 交互模式，可通过拖拽表格分隔线，来调整表格列宽</span></span><br><span class="line">    Stretch,<span class="comment">// 拉伸模式，使每一列的宽度都相等，并占满表格，且无法手动调整列宽</span></span><br><span class="line">    Fixed, <span class="comment">// 固定模式，使每一列的宽度都固定</span></span><br><span class="line">    ResizeToContents, <span class="comment">// 变化模式，根据列标题文字宽度，来决定表格列宽</span></span><br><span class="line">    Custom = Fixed<span class="comment">// 自定义，默认为固定模式</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>上述几种模式各有优缺点，所以一般都混合使用。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置水平表头为拉伸模式，并使得第一列的列宽为50；</span></span><br><span class="line">table-&gt;<span class="built_in">horizontalHeader</span>()-&gt;<span class="built_in">setSectionResizeMode</span>(QHeaderView::Stretch);</span><br><span class="line">table-&gt;<span class="built_in">horizontalHeader</span>()-&gt;<span class="built_in">setSectionResizeMode</span>(<span class="number">0</span>, QHeaderView::Fixed);</span><br><span class="line">table-&gt;<span class="built_in">setColumnWidth</span>(<span class="number">0</span>, <span class="number">50</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置水平表头为交互模式，并使得最后一列自动拉伸</span></span><br><span class="line">table-&gt;<span class="built_in">horizontalHeader</span>()-&gt;<span class="built_in">setSectionResizeMode</span>(QHeaderView::Interactive);</span><br><span class="line">table-&gt;<span class="built_in">horizontalHeader</span>()-&gt;<span class="built_in">setStretchLatSection</span>(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure><h3 id="添加表格数据"><a href="#添加表格数据" class="headerlink" title="添加表格数据"></a>添加表格数据</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置行数：</span></span><br><span class="line"><span class="comment">//   方法1：table-&gt;setRowCount(row);</span></span><br><span class="line"><span class="comment">//   方法2：table-&gt;inserRow(row);</span></span><br><span class="line"><span class="type">int</span> row = table-&gt;<span class="built_in">rowCount</span>();</span><br><span class="line">table-&gt;<span class="built_in">insertRow</span>(row);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加数据</span></span><br><span class="line">QStringList data;</span><br><span class="line">data &lt;&lt; <span class="string">&quot;1001&quot;</span> &lt;&lt; <span class="string">&quot;用户1&quot;</span> &lt;&lt; <span class="string">&quot;女&quot;</span> &lt;&lt; <span class="string">&quot;18&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; data.<span class="built_in">size</span>(); i++)</span><br><span class="line">&#123;</span><br><span class="line">    QTableWidgetItem* item = <span class="keyword">new</span> <span class="built_in">QTableWidgetItem</span>();</span><br><span class="line">    item-&gt;<span class="built_in">setText</span>(QString::<span class="built_in">number</span>(i));</span><br><span class="line">    table-&gt;<span class="built_in">setItem</span>(row, i, item);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><script src="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/js/lightgallery.min.js"></script><script>if("undefined"!=typeof lightGallery) {        var options1 = {            selector: '.gallery-item'        };        lightGallery(document.getElementsByClassName('.article-gallery')[0], options1);        }</script>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>QT-QStyledItemDelegate类</title>
      <link href="/2024/07/15/QT-QStyledItemDelegate%E7%B1%BB/"/>
      <url>/2024/07/15/QT-QStyledItemDelegate%E7%B1%BB/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/lightgallery.min.css" /><div class=".article-gallery"><h2 id="QStyledItemDelegate"><a href="#QStyledItemDelegate" class="headerlink" title="QStyledItemDelegate"></a>QStyledItemDelegate</h2><p>在QT中，当我们在视图中显示来自模型的数据时，采用的是<code>委托</code>的方式进行绘制每一个项目（单元格）。可以自定义项目处于编辑状态时的显示方式，来减少自定义项目的代码量。</p><p><code>QStyledItemDelegate</code> 是QT提供给视图的默认委托，其在项目（单元格）被创建时安装，相似的还有<code>QItemDelegate</code>类。</p><p>若委托不支持绘制所需要的数据类型，我们需要子类化<code>QStyledItemDelegate</code> 来绘制自定义项目的显示方式。</p><blockquote><p>比如，我们想在<code>QTableView</code>的单元格中显示一个<code>QProcessBar</code>控件，就需要自定义委托。</p></blockquote><p>自定义委托需要实现以下虚函数：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 指定index项在编辑时显示的编辑器(editor)，并返回，父控件(parent)和样式选项(option)用于控制editor的显示方式</span></span><br><span class="line"><span class="function">QWidget *<span class="title">createEditor</span><span class="params">(QWidget *parent,</span></span></span><br><span class="line"><span class="params"><span class="function">                      <span class="type">const</span> QStyleOptionViewItem &amp;option,</span></span></span><br><span class="line"><span class="params"><span class="function">                      <span class="type">const</span> QModelIndex &amp;index)</span> <span class="type">const</span> <span class="keyword">override</span></span>;</span><br><span class="line"><span class="comment">// 获取index项的数据，并显示在编辑器(editor)中</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">setEditorData</span><span class="params">(QWidget *editor, <span class="type">const</span> QModelIndex &amp;index)</span> <span class="type">const</span> <span class="keyword">override</span></span>;</span><br><span class="line"><span class="comment">// 将编辑器(editor)的数据更新到模型中</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">setModelData</span><span class="params">(QWidget *editor,</span></span></span><br><span class="line"><span class="params"><span class="function">                  QAbstractItemModel *model,</span></span></span><br><span class="line"><span class="params"><span class="function">                  <span class="type">const</span> QModelIndex &amp;index)</span> <span class="type">const</span> <span class="keyword">override</span></span>;</span><br><span class="line"><span class="comment">// 设置编辑器相对于index项的显示位置</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">updateEditorGeometry</span><span class="params">(QWidget *editor,</span></span></span><br><span class="line"><span class="params"><span class="function">                          <span class="type">const</span> QStyleOptionViewItem &amp;option,</span></span></span><br><span class="line"><span class="params"><span class="function">                          <span class="type">const</span> QModelIndex &amp;index)</span> <span class="type">const</span> <span class="keyword">override</span></span>;</span><br></pre></td></tr></table></figure><p>如果需要默认就显示指定的控件，还需要实现 <code>paint()</code> 和 <code>sizeHint()</code>，其中 <code>sizeHint()</code> 可选；</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">paint</span><span class="params">(QPainter *painter,</span></span></span><br><span class="line"><span class="params"><span class="function">               <span class="type">const</span> QStyleOptionViewItem &amp;option, <span class="type">const</span> QModelIndex &amp;index)</span> <span class="type">const</span> <span class="keyword">override</span></span>;</span><br><span class="line"><span class="function">QSize <span class="title">sizeHint</span><span class="params">(<span class="type">const</span> QStyleOptionViewItem &amp;option,</span></span></span><br><span class="line"><span class="params"><span class="function">               <span class="type">const</span> QModelIndex &amp;index)</span> <span class="type">const</span> <span class="keyword">override</span></span>;</span><br></pre></td></tr></table></figure><h2 id="自定义委托-——-QSpinBox"><a href="#自定义委托-——-QSpinBox" class="headerlink" title="自定义委托 —— QSpinBox"></a>自定义委托 —— QSpinBox</h2><p>需求：</p><p>(1). 为<code>QTableView</code>中任意一列设置委托，设置其编辑时控件为<code>QSpinBox</code>； </p><p>(2). 为<code>QTableView</code>中任意一列设置委托，设置其显示时控件为<code>QProcessBar</code>；</p><h3 id="自定义委托：CustomSpinBoxDelegate"><a href="#自定义委托：CustomSpinBoxDelegate" class="headerlink" title="自定义委托：CustomSpinBoxDelegate"></a>自定义委托：CustomSpinBoxDelegate</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><h3 id="主界面：MainWidget"><a href="#主界面：MainWidget" class="headerlink" title="主界面：MainWidget"></a>主界面：MainWidget</h3></div><script src="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/js/lightgallery.min.js"></script><script>if("undefined"!=typeof lightGallery) {        var options1 = {            selector: '.gallery-item'        };        lightGallery(document.getElementsByClassName('.article-gallery')[0], options1);        }</script>]]></content>
      
      
      
        <tags>
            
            <tag> QT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/07/04/QT-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%9B%BE%E5%85%83/"/>
      <url>/2024/07/04/QT-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%9B%BE%E5%85%83/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/lightgallery.min.css" /><div class=".article-gallery"><h1 id="定制化图元"><a href="#定制化图元" class="headerlink" title="定制化图元"></a>定制化图元</h1><h2 id="CustomGraphicRectItem-h"><a href="#CustomGraphicRectItem-h" class="headerlink" title="CustomGraphicRectItem.h"></a>CustomGraphicRectItem.h</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> CUSTOMGRAPHICRECTITEM_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CUSTOMGRAPHICRECTITEM_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QGraphicsItem&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QIcon&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QPainter&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QBrush&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QPixmap&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">b_item</span> &#123;</span><br><span class="line">    QIcon icon;</span><br><span class="line">    QString text1;</span><br><span class="line">    QString text2;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CustomGraphicRectItem</span> : <span class="keyword">public</span> QObject, <span class="keyword">public</span> QGraphicsItem</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">CustomGraphicRectItem</span><span class="params">(QString topText, QList&lt;QList&lt;b_item&gt;&gt; dataList, QGraphicsItem *parent = <span class="literal">nullptr</span>)</span></span>;</span><br><span class="line">    ~<span class="built_in">CustomGraphicRectItem</span>();</span><br><span class="line"></span><br><span class="line">    <span class="function">QRectF <span class="title">boundingRect</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">paint</span><span class="params">(QPainter *painter, <span class="type">const</span> QStyleOptionGraphicsItem *option, QWidget *widget = <span class="literal">nullptr</span>)</span> <span class="keyword">override</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">totalHeight</span><span class="params">()</span> <span class="type">const</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setTotalHeight</span><span class="params">(<span class="type">int</span> totalHeight)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> m_baseWidth;</span><br><span class="line">    <span class="type">int</span> m_baseHeight;</span><br><span class="line">    <span class="type">int</span> m_totalHeight;</span><br><span class="line">    QString m_topText;</span><br><span class="line">    QList&lt;QList&lt;b_item&gt;&gt; m_dataList;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// CUSTOMGRAPHICRECTITEM_H</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="CustomGraphicRectItem-cpp"><a href="#CustomGraphicRectItem-cpp" class="headerlink" title="CustomGraphicRectItem.cpp"></a>CustomGraphicRectItem.cpp</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;CustomGraphicRectItem.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QDebug&gt;</span></span></span><br><span class="line"></span><br><span class="line">CustomGraphicRectItem::<span class="built_in">CustomGraphicRectItem</span>(QString topText, QList&lt;QList&lt;b_item&gt;&gt; dataList, QGraphicsItem *parent) :</span><br><span class="line">    <span class="built_in">QGraphicsItem</span>(parent), <span class="built_in">m_baseWidth</span>(<span class="number">150</span>), <span class="built_in">m_baseHeight</span>(<span class="number">30</span>), <span class="built_in">m_totalHeight</span>(<span class="number">30</span>), <span class="built_in">m_topText</span>(topText), <span class="built_in">m_dataList</span>(dataList)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span>(QList&lt;b_item&gt; &amp;row : dataList)</span><br><span class="line">    &#123;</span><br><span class="line">        m_totalHeight += row.<span class="built_in">size</span>() * m_baseHeight;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; row.<span class="built_in">size</span>() &lt;&lt; m_totalHeight;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;矩形总高度：&quot;</span> &lt;&lt; m_totalHeight;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CustomGraphicRectItem::~<span class="built_in">CustomGraphicRectItem</span>()</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">QRectF <span class="title">CustomGraphicRectItem::boundingRect</span><span class="params">()</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">QRectF</span>(<span class="number">0</span>, <span class="number">0</span>, m_baseWidth, m_totalHeight);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">CustomGraphicRectItem::paint</span><span class="params">(QPainter *painter, <span class="type">const</span> QStyleOptionGraphicsItem *option, QWidget *widget)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QRect topRect = <span class="built_in">QRect</span>(<span class="number">0</span>, <span class="number">0</span>, m_baseWidth, m_baseHeight);</span><br><span class="line">    painter-&gt;<span class="built_in">setBrush</span>(<span class="built_in">QBrush</span>(Qt::yellow));</span><br><span class="line">    painter-&gt;<span class="built_in">drawRect</span>(topRect);</span><br><span class="line">    painter-&gt;<span class="built_in">drawText</span>(topRect, Qt::AlignCenter, m_topText);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> curHeight = m_baseHeight;</span><br><span class="line">    <span class="type">int</span> cellHeight = <span class="number">0</span>;</span><br><span class="line">    painter-&gt;<span class="built_in">setBrush</span>(<span class="built_in">QBrush</span>(Qt::lightGray));</span><br><span class="line">    <span class="keyword">for</span>(QList&lt;b_item&gt; &amp;row : m_dataList)</span><br><span class="line">    &#123;</span><br><span class="line">        cellHeight = row.<span class="built_in">size</span>() * m_baseHeight;</span><br><span class="line">        QRect cellRect = <span class="built_in">QRect</span>(<span class="number">0</span>, curHeight, m_baseWidth, cellHeight);</span><br><span class="line">        painter-&gt;<span class="built_in">drawRect</span>(cellRect);</span><br><span class="line">        <span class="type">int</span> drawHeight = curHeight;</span><br><span class="line">        <span class="keyword">for</span>(b_item &amp;item : row)</span><br><span class="line">        &#123;</span><br><span class="line">            QRect cellLeftRect = <span class="built_in">QRect</span>((m_baseHeight - <span class="number">16</span>) * <span class="number">0.5</span>, drawHeight + (m_baseHeight - <span class="number">16</span>) * <span class="number">0.5</span>, <span class="number">16</span>, <span class="number">16</span>);</span><br><span class="line">            QRect cellCenterRect = <span class="built_in">QRect</span>(m_baseHeight, drawHeight, (m_baseWidth - m_baseHeight) * <span class="number">0.5</span>, m_baseHeight);</span><br><span class="line">            QRect cellRightRect = <span class="built_in">QRect</span>(m_baseHeight + (m_baseWidth - m_baseHeight) * <span class="number">0.5</span>, drawHeight, (m_baseWidth - m_baseHeight) * <span class="number">0.5</span>, m_baseHeight);</span><br><span class="line">            <span class="keyword">if</span>(!item.icon.<span class="built_in">isNull</span>())</span><br><span class="line">            &#123;</span><br><span class="line">                QPixmap pixmap = item.icon.<span class="built_in">pixmap</span>(<span class="built_in">QSize</span>(<span class="number">16</span>, <span class="number">16</span>));</span><br><span class="line">                painter-&gt;<span class="built_in">drawPixmap</span>(cellLeftRect, pixmap);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(!item.text1.<span class="built_in">isEmpty</span>())</span><br><span class="line">            &#123;</span><br><span class="line">                painter-&gt;<span class="built_in">drawText</span>(cellCenterRect, Qt::AlignLeft | Qt::AlignVCenter, item.text1);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(!item.text2.<span class="built_in">isEmpty</span>())</span><br><span class="line">            &#123;</span><br><span class="line">                painter-&gt;<span class="built_in">drawText</span>(cellRightRect, Qt::AlignLeft | Qt::AlignVCenter, item.text2);</span><br><span class="line">            &#125;</span><br><span class="line">            drawHeight += m_baseHeight;</span><br><span class="line">        &#125;</span><br><span class="line">        curHeight += cellHeight;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">CustomGraphicRectItem::totalHeight</span><span class="params">()</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> m_totalHeight;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">CustomGraphicRectItem::setTotalHeight</span><span class="params">(<span class="type">int</span> totalHeight)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_totalHeight = totalHeight;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="定制化场景"><a href="#定制化场景" class="headerlink" title="定制化场景"></a>定制化场景</h1><h2 id="CustomGraphicScene-h"><a href="#CustomGraphicScene-h" class="headerlink" title="CustomGraphicScene.h"></a>CustomGraphicScene.h</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> CUSTOMGRAPHICSCENE_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CUSTOMGRAPHICSCENE_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QGraphicsScene&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;CustomGraphicRectItem.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CustomGraphicScene</span> : <span class="keyword">public</span> QGraphicsScene</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">CustomGraphicScene</span><span class="params">(QObject *parent = <span class="literal">nullptr</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">CustomGraphicScene</span>();</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addItemNSetPos</span><span class="params">(CustomGraphicRectItem *item)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">lineHeight</span><span class="params">()</span> <span class="type">const</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setLineHeight</span><span class="params">(<span class="type">int</span> lineHeight)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> m_totalHeight;</span><br><span class="line">    <span class="type">int</span> m_lineHeight;</span><br><span class="line">    CustomGraphicRectItem *m_lastItem;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// CUSTOMGRAPHICSCENE_H</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="CustomGraphicScene-cpp"><a href="#CustomGraphicScene-cpp" class="headerlink" title="CustomGraphicScene.cpp"></a>CustomGraphicScene.cpp</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;CustomGraphicScene.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">CustomGraphicScene::<span class="built_in">CustomGraphicScene</span>(QObject *parent) :</span><br><span class="line">    <span class="built_in">QGraphicsScene</span>(parent), <span class="built_in">m_totalHeight</span>(<span class="number">0</span>), <span class="built_in">m_lineHeight</span>(<span class="number">30</span>), <span class="built_in">m_lastItem</span>(<span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">CustomGraphicScene::~<span class="built_in">CustomGraphicScene</span>()</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">CustomGraphicScene::addItemNSetPos</span><span class="params">(CustomGraphicRectItem *item)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>-&gt;<span class="built_in">addItem</span>(item);</span><br><span class="line">    item-&gt;<span class="built_in">setPos</span>(<span class="number">0</span>, <span class="keyword">this</span>-&gt;m_totalHeight);</span><br><span class="line">    <span class="keyword">this</span>-&gt;m_totalHeight += item-&gt;<span class="built_in">totalHeight</span>() + m_lineHeight;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>-&gt;m_lastItem)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 获取上一个图元的边界矩形的底部中心点</span></span><br><span class="line">        QPointF startPoint = <span class="built_in">QPointF</span>(m_lastItem-&gt;<span class="built_in">boundingRect</span>().<span class="built_in">center</span>().<span class="built_in">x</span>(), m_lastItem-&gt;<span class="built_in">boundingRect</span>().<span class="built_in">bottom</span>() + <span class="number">1</span>);</span><br><span class="line">        <span class="comment">// 获取新图元的边界矩形的顶部中心点</span></span><br><span class="line">        QPointF endPoint = <span class="built_in">QPointF</span>(item-&gt;<span class="built_in">boundingRect</span>().<span class="built_in">center</span>().<span class="built_in">x</span>(), item-&gt;<span class="built_in">boundingRect</span>().<span class="built_in">top</span>());</span><br><span class="line">        <span class="comment">// 将两个点的坐标转换为场景坐标</span></span><br><span class="line">        startPoint = m_lastItem-&gt;<span class="built_in">mapToScene</span>(startPoint);</span><br><span class="line">        endPoint = item-&gt;<span class="built_in">mapToScene</span>(endPoint);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建线条图元连接这两个点</span></span><br><span class="line">        QGraphicsLineItem *line = <span class="keyword">new</span> <span class="built_in">QGraphicsLineItem</span>(<span class="built_in">QLineF</span>(startPoint, endPoint));</span><br><span class="line">        QPen pen;</span><br><span class="line">        pen.<span class="built_in">setWidth</span>(<span class="number">2</span>);</span><br><span class="line">        line-&gt;<span class="built_in">setPen</span>(pen);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 绘制朝下的箭头</span></span><br><span class="line">        QPolygonF arrowHead;</span><br><span class="line">        arrowHead &lt;&lt; <span class="built_in">QPointF</span>(<span class="number">-3</span>, <span class="number">-10</span>) &lt;&lt; <span class="built_in">QPointF</span>(<span class="number">0</span>, <span class="number">0</span>) &lt;&lt; <span class="built_in">QPointF</span>(<span class="number">3</span>, <span class="number">-10</span>);</span><br><span class="line">        QGraphicsPolygonItem *arrow = <span class="keyword">new</span> <span class="built_in">QGraphicsPolygonItem</span>(arrowHead);</span><br><span class="line">        arrow-&gt;<span class="built_in">setBrush</span>(Qt::black);</span><br><span class="line">        arrow-&gt;<span class="built_in">setPos</span>(endPoint);</span><br><span class="line">        <span class="keyword">this</span>-&gt;<span class="built_in">addItem</span>(line);</span><br><span class="line">        <span class="keyword">this</span>-&gt;<span class="built_in">addItem</span>(arrow);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>-&gt;m_lastItem = item;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">CustomGraphicScene::lineHeight</span><span class="params">()</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> m_lineHeight;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">CustomGraphicScene::setLineHeight</span><span class="params">(<span class="type">int</span> lineHeight)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_lineHeight = lineHeight;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Widget.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ui_Widget.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">Widget::<span class="built_in">Widget</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QWidget</span>(parent)</span><br><span class="line">    , <span class="built_in">ui</span>(<span class="keyword">new</span> Ui::Widget)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">// 加载场景</span></span><br><span class="line">    CustomGraphicScene *scene = <span class="keyword">new</span> CustomGraphicScene;</span><br><span class="line">    ui-&gt;graphicsView-&gt;<span class="built_in">setScene</span>(scene);</span><br><span class="line"></span><br><span class="line">    QList&lt;QList&lt;b_item&gt;&gt; dataList;</span><br><span class="line">    dataList.<span class="built_in">append</span>(&#123;&#123;<span class="built_in">QIcon</span>(<span class="string">&quot;:/test.png&quot;</span>), <span class="string">&quot;111&quot;</span>, <span class="string">&quot;112&quot;</span>&#125;, &#123;<span class="built_in">QIcon</span>(<span class="string">&quot;:/test.png&quot;</span>), <span class="string">&quot;121&quot;</span>, <span class="string">&quot;122&quot;</span>&#125;&#125;);</span><br><span class="line">    dataList.<span class="built_in">append</span>(&#123;&#123;<span class="built_in">QIcon</span>(), <span class="string">&quot;211&quot;</span>, <span class="string">&quot;212&quot;</span>&#125;&#125;);</span><br><span class="line">    dataList.<span class="built_in">append</span>(&#123;&#123;<span class="built_in">QIcon</span>(<span class="string">&quot;:/test.png&quot;</span>), <span class="string">&quot;311&quot;</span>, <span class="string">&quot;312&quot;</span>&#125;, &#123;<span class="built_in">QIcon</span>(<span class="string">&quot;:/test.png&quot;</span>), <span class="string">&quot;321&quot;</span>, <span class="string">&quot;322&quot;</span>&#125;&#125;);</span><br><span class="line"></span><br><span class="line">    CustomGraphicRectItem *item = <span class="keyword">new</span> <span class="built_in">CustomGraphicRectItem</span>(<span class="string">&quot;节点1&quot;</span>, dataList);</span><br><span class="line">    CustomGraphicRectItem *item2 = <span class="keyword">new</span> <span class="built_in">CustomGraphicRectItem</span>(<span class="string">&quot;节点2&quot;</span>, dataList);</span><br><span class="line">    CustomGraphicRectItem *item3 = <span class="keyword">new</span> <span class="built_in">CustomGraphicRectItem</span>(<span class="string">&quot;节点3&quot;</span>, dataList);</span><br><span class="line"></span><br><span class="line">    scene-&gt;<span class="built_in">addItemNSetPos</span>(item);</span><br><span class="line">    scene-&gt;<span class="built_in">addItemNSetPos</span>(item2);</span><br><span class="line">    scene-&gt;<span class="built_in">addItemNSetPos</span>(item3);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Widget::~<span class="built_in">Widget</span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">delete</span> ui;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><script src="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/js/lightgallery.min.js"></script><script>if("undefined"!=typeof lightGallery) {        var options1 = {            selector: '.gallery-item'        };        lightGallery(document.getElementsByClassName('.article-gallery')[0], options1);        }</script>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/07/04/QT-QCalendarWidget/"/>
      <url>/2024/07/04/QT-QCalendarWidget/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/lightgallery.min.css" /><div class=".article-gallery"><h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">QCalendarWidget *calendar = <span class="keyword">new</span> <span class="built_in">QCalendarWidget</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 隐藏导航栏</span></span><br><span class="line">calendar-&gt;<span class="built_in">setNavigationBarVisible</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 隐藏日期网格线</span></span><br><span class="line">calendar-&gt;<span class="built_in">setGridVisible</span>(<span class="literal">false</span>);</span><br><span class="line"><span class="comment">// 设置每列第一天为周几</span></span><br><span class="line">calendar-&gt;<span class="built_in">setFirstDayOfWeek</span>(Qt::Saturday);</span><br><span class="line"><span class="comment">// 设置周几显示的文字类型</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    QCalendarWidget::NoHorizontalHeader:    0, 隐藏日期标题</span></span><br><span class="line"><span class="comment">    QCalendarWidget::SingleLetterDayNames:  1, 日期首字母缩写(如M, T, S, T, F, S, S)</span></span><br><span class="line"><span class="comment">    QCalendarWidget::ShortDayNames:         2, 日期简写</span></span><br><span class="line"><span class="comment">    QCalendarWidget::LongDayNames:          3, 日期全称</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">calendar-&gt;<span class="built_in">setHorizontalHeaderFormat</span>(QCalendarWidget::SingleLetterDayNames);</span><br></pre></td></tr></table></figure><h2 id="样式"><a href="#样式" class="headerlink" title="样式"></a>样式</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/* 日历全样式 */</span></span><br><span class="line">QCalendarWidget QWidget &#123;</span><br><span class="line">    <span class="attribute">font</span>: <span class="number">14px</span> Microsoft YaHei;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">rgb</span>(<span class="number">128</span>, <span class="number">128</span>, <span class="number">128</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 日历导航栏样式 */</span></span><br><span class="line"><span class="selector-id">#qt_calendar_navigationbar</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 按钮样式：上个月、下个月 */</span></span><br><span class="line"><span class="selector-id">#qt_calendar_prevmouth</span> &#123;&#125;;</span><br><span class="line"><span class="selector-id">#qt_calendar_nextmouth</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 按钮样式：当前月份-正常状态、选择状态 */</span></span><br><span class="line">QToolButton<span class="selector-id">#qt_calendar_mouthbutton</span> &#123;&#125;;</span><br><span class="line">QCalendarWidget QMenu &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 按钮样式：当前年份-正常状态、选择状态*/</span></span><br><span class="line">QToolButton<span class="selector-id">#qt_calendar_yearbutton</span> &#123;&#125;;</span><br><span class="line">QCalendarWidget QSpinBox<span class="selector-id">#qt_calendar_yearedit</span> &#123;&#125;;</span><br><span class="line">QCalendarWidget QSpinBox<span class="selector-id">#qt_calendar_yearedit</span>::up-arrow &#123;&#125;;     <span class="comment">/* 上箭头 */</span></span><br><span class="line">QCalendarWidget QSpinBox<span class="selector-id">#qt_calendar_yearedit</span>::down-arrow &#123;&#125;;   <span class="comment">/* 下箭头 */</span></span><br><span class="line">QCalendarWidget QSpinBox<span class="selector-id">#qt_calendar_yearedit</span>::up-button &#123;&#125;;    <span class="comment">/* 上图标 */</span></span><br><span class="line">QCalendarWidget QSpinBox<span class="selector-id">#qt_calendar_yearedit</span>::down-button &#123;&#125;;  <span class="comment">/* 下图标 */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 周栏 */</span></span><br><span class="line"><span class="comment">/* 样式：周一到周五 */</span></span><br><span class="line">QCalendarWidget QTableView &#123;</span><br><span class="line">    alternate-<span class="attribute">background-color</span>: blue;</span><br><span class="line">    <span class="attribute">color</span>: black;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/* 样式：周六到周日（需要代码单独设置） */</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">QTextCharFormat weekendFormat;</span></span><br><span class="line"><span class="comment">weekendFormat.setForeground(QBrush(QColor(153, 51, 255)));</span></span><br><span class="line"><span class="comment">calendar-&gt;setWeekdayTextFormat(Qt::Saturday, weekendFormat);</span></span><br><span class="line"><span class="comment">calendar-&gt;setWeekdayTextFormat(Qt::Sunday, weekendFormat);</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 日期栏 */</span></span><br><span class="line"><span class="selector-id">#qt_calendar_calendarview</span>&#123;</span><br><span class="line">        <span class="attribute">background-color</span>:<span class="built_in">rgb</span>(<span class="number">229</span>, <span class="number">229</span>, <span class="number">252</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/* 选中月日期 */</span></span><br><span class="line">QCalendarWidget QAbstractItemView<span class="selector-pseudo">:enabled</span>&#123;</span><br><span class="line">        <span class="attribute">font</span>:<span class="number">18px</span> Microsoft YaHei;</span><br><span class="line">        <span class="attribute">color</span>:<span class="built_in">rgb</span>(<span class="number">0</span>, <span class="number">204</span>, <span class="number">204</span>);</span><br><span class="line">        selection-<span class="attribute">color</span>:<span class="built_in">rgb</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>);</span><br><span class="line">        selection-<span class="attribute">background-color</span>:<span class="built_in">rgb</span>(<span class="number">0</span>, <span class="number">102</span>, <span class="number">102</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/* 非选中月日期 */</span></span><br><span class="line">QCalendarWidget QAbstractItemView<span class="selector-pseudo">:disabled</span>&#123;</span><br><span class="line">        <span class="attribute">color</span>:<span class="built_in">rgb</span>(<span class="number">204</span>, <span class="number">255</span>, <span class="number">204</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><script src="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/js/lightgallery.min.js"></script><script>if("undefined"!=typeof lightGallery) {        var options1 = {            selector: '.gallery-item'        };        lightGallery(document.getElementsByClassName('.article-gallery')[0], options1);        }</script>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/07/04/QT-QAbstractSpinBox/"/>
      <url>/2024/07/04/QT-QAbstractSpinBox/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/lightgallery.min.css" /><div class=".article-gallery"><h1 id="QAbstractSpinBox"><a href="#QAbstractSpinBox" class="headerlink" title="QAbstractSpinBox"></a>QAbstractSpinBox</h1><p><code>QAbstractSpinBox</code>，是所有带有微调输入框的抽象基类。<br>是一种允许用户通过点击上下箭头按钮或输入数字来调整数值的GUI控件。</p><h2 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h2><p><code>QAbstractSpinBox</code>类提供了一些常用属性来定制微调器控件的行为和外观。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// wrapping: 取值范围是否头尾相连（最大值向上回到到最小值，最小值向下回到最大值）</span></span><br><span class="line"><span class="built_in">Q_PROPERTY</span>(<span class="type">bool</span> wrapping READ wrapping WRITE setWrapping)</span><br><span class="line"></span><br><span class="line"><span class="comment">// frame: 是否显示微调器控件的边框</span></span><br><span class="line"><span class="built_in">Q_PROPERTY</span>(<span class="type">bool</span> frame READ hasFrame WRITE setFrame)</span><br><span class="line"></span><br><span class="line"><span class="comment">// alignment: 文本对齐方式。默认左对齐Qt::AlignLeft</span></span><br><span class="line"><span class="built_in">Q_PROPERTY</span>(Qt::Alignment alignment READ alignment WRITE setAlignment)</span><br><span class="line"></span><br><span class="line"><span class="comment">// readOnly: 输入框只读（不可编辑，可复制，不显示光标）</span></span><br><span class="line"><span class="built_in">Q_PROPERTY</span>(<span class="type">bool</span> readOnly READ isReadOnly WRITE setReadOnly)</span><br><span class="line"></span><br><span class="line"><span class="comment">// buttonSymbols: 设置上下键按钮的样式</span></span><br><span class="line"><span class="comment">// * 上下箭头：QAbstractSpinBox::UpDownArrow</span></span><br><span class="line"><span class="comment">// * 加减按钮：QAbstractSpinBox::PlusMinus</span></span><br><span class="line"><span class="comment">// * 无需按钮：QAbstractSpinBox::NoButtons</span></span><br><span class="line"><span class="built_in">Q_PROPERTY</span>(ButtonSymbols buttonSymbols READ buttonSymbols WRITE setButtonSymbols)</span><br><span class="line"></span><br><span class="line"><span class="comment">// specialValueText: 显示特殊文本。若当前值 == minimum()，显示此文本）</span></span><br><span class="line"><span class="built_in">Q_PROPERTY</span>(QString specialValueText READ specialValueText WRITE setSpecialValueText)</span><br><span class="line"></span><br><span class="line"><span class="comment">// text: 保存输入框当前文本</span></span><br><span class="line"><span class="built_in">Q_PROPERTY</span>(QString text READ text)</span><br><span class="line"></span><br><span class="line"><span class="comment">// accelerated: 是否启用加速（按住上下键时）</span></span><br><span class="line"><span class="built_in">Q_PROPERTY</span>(<span class="type">bool</span> accelerated READ isAccelerated WRITE setAccelerated)</span><br><span class="line"></span><br><span class="line"><span class="comment">// correctionMode: 设置用户在输入无效值时的纠正模式</span></span><br><span class="line"><span class="comment">// 将输入的无效值纠正为上一个有效值: QAbstractSpinBox::CorrectToPreviousValue</span></span><br><span class="line"><span class="comment">// 将输入的无效值纠正为最接近的有效值: QAbstractSpinBox::CorrectToNearestValue</span></span><br><span class="line"><span class="built_in">Q_PROPERTY</span>(CorrectionMode correctionMode READ correctionMode WRITE setCorrectionMode)</span><br><span class="line"></span><br><span class="line"><span class="comment">// acceptableInput: 表示当前输入是否满足验证</span></span><br><span class="line"><span class="built_in">Q_PROPERTY</span>(<span class="type">bool</span> acceptableInput READ hasAcceptableInput)</span><br><span class="line"></span><br><span class="line"><span class="comment">// keyboardTracking: 是否启用键盘跟踪</span></span><br><span class="line"><span class="comment">// 启用后，当键盘输入新值时，spinBox会发出valueChanged()信号和textChanged()信号</span></span><br><span class="line"><span class="built_in">Q_PROPERTY</span>(<span class="type">bool</span> keyboardTracking READ keyboardTracking WRITE setKeyboardTracking)</span><br><span class="line"></span><br><span class="line"><span class="comment">// showGroupSeperator: 是否显示千位分隔符，默认false（如 12,999）</span></span><br><span class="line"><span class="built_in">Q_PROPERTY</span>(<span class="type">bool</span> showGroupSeparator READ isGroupSeparatorShown WRITE setGroupSeparatorShown)</span><br></pre></td></tr></table></figure><h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 修复用户输入的不正确的值（继承自QValidator类）</span></span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">fixup</span><span class="params">(QString &amp;input)</span> <span class="type">const</span></span>;</span><br><span class="line"><span class="comment">// 验证用户输入的字符串是否有效</span></span><br><span class="line"><span class="comment">// 参数为：验证的字符串，光标的位置</span></span><br><span class="line"><span class="comment">// QValidator::Acceptable：字符串有效</span></span><br><span class="line"><span class="comment">// QValidator::Invalid：字符串无效</span></span><br><span class="line"><span class="comment">// QValidator::Intermediate：字符串有效性待定，需继续输入</span></span><br><span class="line"><span class="function"><span class="keyword">virtual</span> QValidator::State <span class="title">validate</span><span class="params">(QString &amp;input, <span class="type">int</span> &amp;pos)</span> <span class="type">const</span></span>;</span><br><span class="line"><span class="comment">// 变更步长</span></span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">stepBy</span><span class="params">(<span class="type">int</span> steps)</span></span>;</span><br><span class="line"><span class="comment">// 递增1个步长，等同于stepBy(1)</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">stepUp</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">// 递减1个步长，等同于stepBy(-1)</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">stepDown</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">// 选择文本，不包含前缀和后缀</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">selectAll</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">// 清除文本，保留前缀和后缀</span></span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">clear</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure><h1 id="QSpinBox"><a href="#QSpinBox" class="headerlink" title="QSpinBox"></a>QSpinBox</h1><h2 id="属性-1"><a href="#属性-1" class="headerlink" title="属性"></a>属性</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置文本前缀</span></span><br><span class="line"><span class="built_in">Q_PROPERTY</span>(QString suffix READ suffix WRITE setSuffix)</span><br><span class="line"><span class="comment">// 设置文本后缀</span></span><br><span class="line"><span class="built_in">Q_PROPERTY</span>(QString prefix READ prefix WRITE setPrefix)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 保存编辑框文本，但不包括任何前缀、后缀、前导、尾部空格</span></span><br><span class="line"><span class="built_in">Q_PROPERTY</span>(QString cleanText READ cleanText)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 预设最小值</span></span><br><span class="line"><span class="built_in">Q_PROPERTY</span>(<span class="type">int</span> minimum READ minimum WRITE setMinimum)</span><br><span class="line"><span class="comment">// 预设最大值</span></span><br><span class="line"><span class="built_in">Q_PROPERTY</span>(<span class="type">int</span> maximum READ maximum WRITE setMaximum)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置上下键的单步步长，默认为1</span></span><br><span class="line"><span class="built_in">Q_PROPERTY</span>(<span class="type">int</span> singleStep READ singleStep WRITE setSingleStep)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置步进类型</span></span><br><span class="line"><span class="comment">// * QAbstractSpinBox::DefaultStepType：默认步进，一般为1</span></span><br><span class="line"><span class="comment">// * QAbstractSpinBox::AdaptiveDecimalStepType: 自适应步长，根据数字的大小自动调整步长</span></span><br><span class="line"><span class="built_in">Q_PROPERTY</span>(StepType stepType READ stepType WRITE setStepType)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 保存当前值</span></span><br><span class="line"><span class="built_in">Q_PROPERTY</span>(<span class="type">int</span> value READ value WRITE setValue NOTIFY valueChanged USER <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置显示值的进制（2，8，10，16，默认10）</span></span><br><span class="line"><span class="built_in">Q_PROPERTY</span>(<span class="type">int</span> displayIntegerBase READ displayIntegerBase WRITE setDisplayIntegerBase)</span><br></pre></td></tr></table></figure><h2 id="方法-1"><a href="#方法-1" class="headerlink" title="方法"></a>方法</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 预设最大值和最小值</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">setRange</span><span class="params">(<span class="type">int</span> minimum, <span class="type">int</span> maximum)</span></span>;</span><br><span class="line"><span class="comment">// 将字符串转为数字</span></span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">int</span> <span class="title">valueFromText</span><span class="params">(<span class="type">const</span> QString &amp;text)</span> <span class="type">const</span></span>;</span><br><span class="line"><span class="comment">// 将数字转为字符串</span></span><br><span class="line"><span class="function"><span class="keyword">virtual</span> QString <span class="title">textFromValue</span><span class="params">(<span class="type">int</span> val)</span> <span class="type">const</span></span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="信号"><a href="#信号" class="headerlink" title="信号"></a>信号</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 文本发生变化时触发</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">textChanged</span><span class="params">(<span class="type">const</span> QString &amp;text)</span></span>;</span><br><span class="line"><span class="comment">// 值发生变化时触发</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">valueChanged</span><span class="params">(<span class="type">int</span> i)</span></span>;</span><br></pre></td></tr></table></figure><h1 id="QDoubleSpinBox"><a href="#QDoubleSpinBox" class="headerlink" title="QDoubleSpinBox"></a>QDoubleSpinBox</h1><h2 id="属性-2"><a href="#属性-2" class="headerlink" title="属性"></a>属性</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置精度</span></span><br><span class="line"><span class="built_in">Q_PROPERTY</span>(<span class="type">int</span> decimals READ decimals WRITE setDecimals)</span><br><span class="line"><span class="comment">// 以下属性与QSpinBox一致，参数由int换为double</span></span><br><span class="line"><span class="built_in">Q_PROPERTY</span>(QString prefix READ prefix WRITE setPrefix)</span><br><span class="line"><span class="built_in">Q_PROPERTY</span>(QString suffix READ suffix WRITE setSuffix)</span><br><span class="line"><span class="built_in">Q_PROPERTY</span>(QString cleanText READ cleanText)</span><br><span class="line"><span class="built_in">Q_PROPERTY</span>(<span class="type">double</span> minimum READ minimum WRITE setMinimum)</span><br><span class="line"><span class="built_in">Q_PROPERTY</span>(<span class="type">double</span> maximum READ maximum WRITE setMaximum)</span><br><span class="line"><span class="built_in">Q_PROPERTY</span>(<span class="type">double</span> singleStep READ singleStep WRITE setSingleStep)</span><br><span class="line"><span class="built_in">Q_PROPERTY</span>(StepType stepType READ stepType WRITE setStepType)</span><br><span class="line"><span class="built_in">Q_PROPERTY</span>(<span class="type">double</span> value READ value WRITE setValue NOTIFY valueChanged USER <span class="literal">true</span>)</span><br></pre></td></tr></table></figure><h2 id="方法-2"><a href="#方法-2" class="headerlink" title="方法"></a>方法</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">QValidator::State <span class="title">validate</span><span class="params">(QString &amp;input, <span class="type">int</span> &amp;pos)</span> <span class="type">const</span> <span class="keyword">override</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">double</span> <span class="title">valueFromText</span><span class="params">(<span class="type">const</span> QString &amp;text)</span> <span class="type">const</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">virtual</span> QString <span class="title">textFromValue</span><span class="params">(<span class="type">double</span> val)</span> <span class="type">const</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fixup</span><span class="params">(QString &amp;str)</span> <span class="type">const</span> <span class="keyword">override</span></span>;</span><br></pre></td></tr></table></figure><h2 id="信号-1"><a href="#信号-1" class="headerlink" title="信号"></a>信号</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">valueChanged</span><span class="params">(<span class="type">double</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">textChanged</span><span class="params">(<span class="type">const</span> QString &amp;)</span></span>;</span><br></pre></td></tr></table></figure></div><script src="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/js/lightgallery.min.js"></script><script>if("undefined"!=typeof lightGallery) {        var options1 = {            selector: '.gallery-item'        };        lightGallery(document.getElementsByClassName('.article-gallery')[0], options1);        }</script>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/07/04/QT-FFMPEG-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"/>
      <url>/2024/07/04/QT-FFMPEG-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/lightgallery.min.css" /><div class=".article-gallery"><h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><ol><li>下载FFMPEG，本次测试版本为<code>4.2.1</code>；</li><li>新建一个项目<code>DemoFFMPEG</code>；</li><li>将下载好的<code>FFMPEG-share</code>包中的<code>bin</code>和<code>include</code>文件夹拷贝到项目下（若勾选了<code>shadow build</code>，需要将<code>bin</code>中的所有dll拷贝到指定的<code>debug/release</code>文件夹下，保证编译的exe和bin中的dll文件在一个目录下）。</li><li>在<code>pro</code>文件中添加：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># exe生成目录（保证编译的exe和bin中的dll文件在一个目录下）</span><br><span class="line"># DESTDIR += bin</span><br><span class="line"></span><br><span class="line"># $$PWD项目根目录</span><br><span class="line">LIBS += $$PWD/lib/sqlite3.lib</span><br><span class="line">INCLUDEPATH += ./ffmpeglib/include</span><br><span class="line">LIBS += $$PWD/ffmpeglib/lib/avcodec.lib  \</span><br><span class="line">        $$PWD/ffmpeglib/lib/avdevice.lib  \</span><br><span class="line">        $$PWD/ffmpeglib/lib/avfilter.lib  \</span><br><span class="line">        $$PWD/ffmpeglib/lib/avformat.lib  \</span><br><span class="line">        $$PWD/ffmpeglib/lib/avutil.lib  \</span><br><span class="line">        $$PWD/ffmpeglib/lib/swresample.lib  \</span><br><span class="line">        $$PWD/ffmpeglib/lib/swscale.lib</span><br></pre></td></tr></table></figure></li><li>测试运行：<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QApplication&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QDebug&gt;</span></span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="meta">#<span class="keyword">include</span><span class="string">&quot;libavcodec/avcodec.h&quot;</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">QApplication <span class="title">a</span><span class="params">(argc, argv)</span></span>;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;FFMPEG version：&quot;</span> &lt;&lt; <span class="built_in">avcodec_version</span>();</span><br><span class="line">    <span class="keyword">return</span> a.<span class="built_in">exec</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>输出：<code>FFMPEG version： 3819878</code>则搭建成功。</li></ol></div><script src="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/js/lightgallery.min.js"></script><script>if("undefined"!=typeof lightGallery) {        var options1 = {            selector: '.gallery-item'        };        lightGallery(document.getElementsByClassName('.article-gallery')[0], options1);        }</script>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/07/04/QT-DateTimeEdit/"/>
      <url>/2024/07/04/QT-DateTimeEdit/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/lightgallery.min.css" /><div class=".article-gallery"></div><script src="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/js/lightgallery.min.js"></script><script>if("undefined"!=typeof lightGallery) {        var options1 = {            selector: '.gallery-item'        };        lightGallery(document.getElementsByClassName('.article-gallery')[0], options1);        }</script>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/07/04/LINUX_%E6%96%87%E4%BB%B6%E6%89%93%E5%BC%80%E6%96%B9%E5%BC%8F/"/>
      <url>/2024/07/04/LINUX_%E6%96%87%E4%BB%B6%E6%89%93%E5%BC%80%E6%96%B9%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/lightgallery.min.css" /><div class=".article-gallery"><h2 id="获取文件MIME类型"><a href="#获取文件MIME类型" class="headerlink" title="获取文件MIME类型"></a>获取文件MIME类型</h2><p>通常情况下，我们会根据文件后缀去获取文件类型，通过获取文件的MIME类型就可以获取到。<br>但有时候，获取到的MIME类型过于精确，当系统里没保存这个文件类型的打开方式时，就获取不到任何的打开方式。<br>MIME是可以相互继承的，所以我们可以通过获取到上级类型，或者通过是否继承自某种类型来获取更通用的打开方式。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QMimeDatabase&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QMimeType&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QDebug&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">getMIMEType</span>(<span class="string">&quot;/root/桌面/1.txt&quot;</span>);</span><br><span class="line">    <span class="built_in">getMIMEType</span>(<span class="string">&quot;/root/桌面/1.md&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">getMIMEType</span><span class="params">(QString filepath)</span> </span>&#123;</span><br><span class="line">    QMimeDatabase db;</span><br><span class="line">    QMimeType type = db.<span class="built_in">mimeTypeForFile</span>(filepath);</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;MIME type of &quot;</span> &lt;&lt; filepath <span class="string">&quot; is :&quot;</span> &lt;&lt; type.<span class="built_in">name</span>() &lt;&lt; type.<span class="built_in">parentMimeTypes</span>();</span><br><span class="line">        <span class="comment">// if (type.inherits(&quot;text/plain&quot;))</span></span><br><span class="line">    <span class="comment">// &#123;</span></span><br><span class="line">    <span class="comment">//     qDebug() &lt;&lt; &quot;MIME type of &quot; &lt;&lt; filepath &quot; is :&quot; &lt;&lt; &quot;text/plain&quot;;</span></span><br><span class="line">    <span class="comment">//     return;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MIME type of  &quot;/root/桌面/1.md&quot;  is : text/plain</span><br></pre></td></tr></table></figure></div><script src="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/js/lightgallery.min.js"></script><script>if("undefined"!=typeof lightGallery) {        var options1 = {            selector: '.gallery-item'        };        lightGallery(document.getElementsByClassName('.article-gallery')[0], options1);        }</script>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/07/04/LINUX_%E7%9B%91%E5%90%AC%E6%96%87%E4%BB%B6%E6%89%93%E5%BC%80%E7%8A%B6%E6%80%81/"/>
      <url>/2024/07/04/LINUX_%E7%9B%91%E5%90%AC%E6%96%87%E4%BB%B6%E6%89%93%E5%BC%80%E7%8A%B6%E6%80%81/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/lightgallery.min.css" /><div class=".article-gallery"><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QCoreApplication&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QSocketNotifier&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/inotify.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QDebug&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">QCoreApplication <span class="title">a</span><span class="params">(argc, argv)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> fd = <span class="number">-1</span>, wd = <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">    fd = <span class="built_in">inotify_init</span>();</span><br><span class="line">    <span class="keyword">if</span> (fd &lt; <span class="number">0</span>) &#123; <span class="built_in">perror</span>(<span class="string">&quot;inotify_init: &quot;</span>); &#125;</span><br><span class="line"></span><br><span class="line">    wd = <span class="built_in">inotify_add_watch</span>(fd, <span class="string">&quot;/opt/WorkSpace/test&quot;</span>, IN_ALL_EVENTS);</span><br><span class="line">    <span class="keyword">if</span> (wd &lt; <span class="number">0</span>) &#123; <span class="built_in">perror</span>(<span class="string">&quot;inotify_add_watch: &quot;</span>); &#125;</span><br><span class="line"></span><br><span class="line">    QSocketNotifier *notifier = <span class="keyword">new</span> <span class="built_in">QSocketNotifier</span>(fd, QSocketNotifier::Read);</span><br><span class="line">    QObject::<span class="built_in">connect</span>(notifier, &amp;QSocketNotifier::activated, [&amp;]() </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> offset = <span class="number">0</span>;</span><br><span class="line">        <span class="type">char</span> buffer[<span class="number">4096</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">        <span class="keyword">struct</span> inotify_event *event = <span class="literal">nullptr</span>;</span><br><span class="line">        <span class="type">int</span> length = <span class="built_in">read</span>(fd, buffer, <span class="built_in">sizeof</span>(buffer));</span><br><span class="line">        <span class="keyword">if</span> (length &lt; <span class="number">0</span>) &#123; <span class="built_in">perror</span>(<span class="string">&quot;read: &quot;</span>); &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (offset &lt; length)</span><br><span class="line">        &#123;</span><br><span class="line">            event = (<span class="keyword">struct</span> inotify_event *)&amp;buffer[offset];</span><br><span class="line">            <span class="keyword">if</span> (event-&gt;len)</span><br><span class="line">            &#123;</span><br><span class="line">                QString operate;</span><br><span class="line">                <span class="type">int</span> mask = event-&gt;mask;</span><br><span class="line">                <span class="keyword">if</span> (mask &amp; IN_ACCESS)        operate = <span class="string">&quot;ACCESS&quot;</span>;</span><br><span class="line">                <span class="keyword">if</span> (mask &amp; IN_ATTRIB)        operate = <span class="string">&quot;ATTRIB&quot;</span>;</span><br><span class="line">                <span class="keyword">if</span> (mask &amp; IN_CLOSE_WRITE)   operate = <span class="string">&quot;CLOSE_WRITE&quot;</span>;</span><br><span class="line">                <span class="keyword">if</span> (mask &amp; IN_CLOSE_NOWRITE) operate = <span class="string">&quot;CLOSE_NOWRITE&quot;</span>;</span><br><span class="line">                <span class="keyword">if</span> (mask &amp; IN_CREATE)        operate = <span class="string">&quot;CREATE&quot;</span>;</span><br><span class="line">                <span class="keyword">if</span> (mask &amp; IN_DELETE_SELF)   operate = <span class="string">&quot;DELETE_SELF&quot;</span>;</span><br><span class="line">                <span class="keyword">if</span> (mask &amp; IN_MODIFY)        operate = <span class="string">&quot;MODIFY&quot;</span>;</span><br><span class="line">                <span class="keyword">if</span> (mask &amp; IN_MOVE_SELF)     operate = <span class="string">&quot;MOVE_SELF&quot;</span>;</span><br><span class="line">                <span class="keyword">if</span> (mask &amp; IN_MOVED_FROM)    operate = <span class="string">&quot;MOVED_FROM&quot;</span>;</span><br><span class="line">                <span class="keyword">if</span> (mask &amp; IN_MOVED_TO)      operate = <span class="string">&quot;MOVED_TO&quot;</span>;</span><br><span class="line">                <span class="keyword">if</span> (mask &amp; IN_OPEN)          operate = <span class="string">&quot;OPEN&quot;</span>;</span><br><span class="line">                <span class="keyword">if</span> (mask &amp; IN_IGNORED)       operate = <span class="string">&quot;IGNORED&quot;</span>;</span><br><span class="line">                <span class="keyword">if</span> (mask &amp; IN_DELETE)        operate = <span class="string">&quot;DELETE&quot;</span>;</span><br><span class="line">                <span class="keyword">if</span> (mask &amp; IN_UNMOUNT)       operate = <span class="string">&quot;UNMOUNT&quot;</span>;</span><br><span class="line">                <span class="built_in">qDebug</span>() &lt;&lt;  event-&gt;name &lt;&lt; operate;</span><br><span class="line">            &#125;</span><br><span class="line">            offset += <span class="built_in">sizeof</span>(<span class="keyword">struct</span> inotify_event) + event-&gt;len;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> a.<span class="built_in">exec</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>相关资料：</p><ol><li><a href="https://juejin.cn/post/6966910863101919269">https://juejin.cn/post/6966910863101919269</a></li><li><a href="https://blog.csdn.net/unonoi/article/details/125744120">https://blog.csdn.net/unonoi/article/details/125744120</a></li><li><a href="https://www.cnblogs.com/PikapBai/p/14480881.html#4%20inotify%20%E5%B8%B8%E7%94%A8%E7%9B%91%E6%8E%A7%E4%BA%8B%E4%BB%B6#">https://www.cnblogs.com/PikapBai/p/14480881.html#4%20inotify%20%E5%B8%B8%E7%94%A8%E7%9B%91%E6%8E%A7%E4%BA%8B%E4%BB%B6#</a></li></ol></div><script src="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/js/lightgallery.min.js"></script><script>if("undefined"!=typeof lightGallery) {        var options1 = {            selector: '.gallery-item'        };        lightGallery(document.getElementsByClassName('.article-gallery')[0], options1);        }</script>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/07/04/LINUX_QT%E5%B7%A5%E7%A8%8B%E6%89%93%E5%8C%85_linuxdeployqt_deb/"/>
      <url>/2024/07/04/LINUX_QT%E5%B7%A5%E7%A8%8B%E6%89%93%E5%8C%85_linuxdeployqt_deb/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/lightgallery.min.css" /><div class=".article-gallery"><h2 id="1-准备：安装打包工具linuxdepoyqt"><a href="#1-准备：安装打包工具linuxdepoyqt" class="headerlink" title="1. 准备：安装打包工具linuxdepoyqt"></a><strong>1.</strong> 准备：安装打包工具linuxdepoyqt</h2><p>(1). 下载inuxdepoyqt </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">转到链接：https://github.com/probonopd/linuxdeployqt/releases</span><br><span class="line">下载文件：linuxdeployqt-countinuous-x86_64.AppImage</span><br></pre></td></tr></table></figure><p>(2). 拷贝到 &#x2F;usr&#x2F;local&#x2F;bin目录中，并重命名</p><p><code>cp linuxdeployqt-continuous-x86_64.AppImage /usr/local/bin/linuxdeployqt</code></p><p>(3). 修改权限</p><p><code>chmod 777 linuxdeployqt </code></p><p>(4). 打印版本信息（检查是否正确安装）</p><p><code>linuxdeployqt -version</code></p><h2 id="2-准备：检查qmake"><a href="#2-准备：检查qmake" class="headerlink" title="2. 准备：检查qmake"></a><strong>2.</strong> 准备：检查qmake</h2><p>(1). 安装qtchooser</p><p><code>apt install qtchooser</code></p><p>(2). 修改default.conf</p><p><code>vim /usr/lib/x86_64-linux-gnu/qt-default/qtchooser/default.conf</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/opt/Qt5.14.2/5.14.2/gcc_64/bin</span><br><span class="line">/opt/Qt5.14.2/5.14.2/</span><br></pre></td></tr></table></figure><p>(3). 打印版本</p><p><code>qmake -v</code></p><h2 id="3-打包"><a href="#3-打包" class="headerlink" title="3. 打包"></a>3. 打包</h2><p>(1). 准备文件夹</p><p>准备一个文件夹，如<code>AppFolder</code>，将<code>qt-release</code>编译生成的可执行文件<code>TestAPP</code>，以及所用到的资源文件（图标、图片、DB文件等）放到<code>AppFolder</code>。</p><p>(2). 自动复制所需库文件</p><p>命令：<code>linuxdeployqt App -appimage</code>，报错执行3.3</p><p>(3). 编辑配置文件</p><p>执行<code>vim default.desktop</code>打开文件，在该文件末尾追加<code>Categories</code>（注意分号不可省略）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[Desktop Entry]</span><br><span class="line">Type=Application</span><br><span class="line">Name=TestAPP</span><br><span class="line">Exec=/usr/src/MyAPP/AppRun %F</span><br><span class="line">Icon=/usr/src/MyAPP/AppRun/images/logo.png</span><br><span class="line">Comment=Edit this default file</span><br><span class="line">Terminal=true</span><br><span class="line">Categories=Application;</span><br></pre></td></tr></table></figure><blockquote><p>desktop官方手册：<a href="https://help.ubuntu.com/community/UnityLaunchersAndDesktopFiles">https://help.ubuntu.com/community/UnityLaunchersAndDesktopFiles</a></p></blockquote><blockquote><p>在<code>Linux</code>系统中，<code>.desktop</code>文件就是用来运行程序的快捷方式，是一个包含程序信息的纯文本文件。</p><p><code>.desktop</code>文件以<code>UTF-8</code>编码，每一行由换行符分割。</p><p><code>.desktop</code>文件通常放在<code>~/.local/share/applications</code>或<code>/usr/share/applications</code>目录下。</p><p>通常，应用程序在安装后都会自动创建<code>.desktop</code>文件，如果是自己使用源代码编译得到的程序或者自己下载的压缩格式的应用，就需要打开终端执行其二进制文件，以及手动创建<code>.desktop</code>文件。</p><p>① 注释：以<code>#</code>开头</p><p>② 组：第一个组必须是<code>[Desktop Entry]</code>，其后跟随的<code>Key=Value</code>都属于该组，直到遇到下一个组为止；</p><p>③ 项：</p><ul><li><p>每一个项的格式均为<code>Key=Value</code>（<code>=</code>两边不能有空格，<code>Key</code>只能用<code>[A-Za-z0-9]</code>，不同组的<code>Key</code>可以同名）</p></li><li><p><code>Value</code>类型有<code>boolean</code>、<code>numberic</code>、<code>string</code>、<code>localestring</code>(用户可显示的用<code>UTF-8</code>的字符串)</p></li><li><p>键的本地化值</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Name=Foo</span><br><span class="line">Name[sr_YU]=...</span><br><span class="line">Name[sr@Latn]=...</span><br><span class="line">Name[sr]=...</span><br></pre></td></tr></table></figure><p>其通用Key为：(<a href="https://blog.csdn.net/u014025444/article/details/94024282">https://blog.csdn.net/u014025444/article/details/94024282</a>)</p><table><thead><tr><th>Key</th><th>描述</th><th>Value Type</th><th>是否必须</th><th>生效的Type</th></tr></thead><tbody><tr><td>Type</td><td>(1). Application<br />(2). Link<br />(3). Directory</td><td>string</td><td>1</td><td></td></tr><tr><td>Name</td><td>应用程序的特定名称</td><td>localstring</td><td>1</td><td></td></tr><tr><td>GenericName</td><td>应用程序的通用名称</td><td>localstring</td><td>0</td><td></td></tr><tr><td>Exec</td><td>执行路径（绝对路径）</td><td>string</td><td>0</td><td></td></tr><tr><td>TryExec</td><td>如果文件不存在, 则忽略该文件，并不在菜单中出现</td><td>string</td><td>0</td><td></td></tr><tr><td>URL</td><td>当Type&#x3D;Link时，可执行文件指向的URL</td><td>string</td><td>1</td><td>(2)</td></tr><tr><td>Comment</td><td>应用描述</td><td>localestring</td><td>0</td><td>1-3</td></tr><tr><td>Icon</td><td>应用图标(绝对路径, 或符合图标主题规范)</td><td>localestring</td><td>0</td><td></td></tr><tr><td>Path</td><td>当Type&#x3D;Application时，程序运行的目录</td><td>string</td><td>0</td><td>1</td></tr></tbody></table><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[Desktop Entry]</span><br><span class="line">Type=Application# </span><br><span class="line">Name=MyAPP# 应用名称</span><br><span class="line">Icon=/path/to/icon# 应用图标，绝对路径</span><br><span class="line">Exec=/path/to/AppRun# 可执行文件的路径，绝对路径</span><br><span class="line">Encoding=UTF-8</span><br><span class="line">Version=0.1.0</span><br><span class="line">Terminal=false</span><br></pre></td></tr></table></figure></blockquote><p>(4). 再次执行</p><p>执行<code>linuxdeployqt App -appimage</code>或<code>sudo linuxdeployqt Appname-appimage -unsupported-allow-new-glibc</code>，最终生成的<code>TestAPP</code>，即可执行。</p><blockquote><p>报错解决：若出现<code>xxx.so.1</code>不存在，需要手动拷贝<code>release</code>文件夹下生成的对应<code>so</code>文件，复制到<code>AppFloder</code>下的<code>lib</code>文件夹中。</p></blockquote><h2 id="4-打包为deb"><a href="#4-打包为deb" class="headerlink" title="4. 打包为deb"></a>4. 打包为deb</h2><p> <code>deb</code>是<code>Debian Linux</code>的软件包格式，通常是以编译源码的方式制作<code>deb</code>包，此处是以生成的发布文件夹的方式制作<code>deb</code>包。</p><p> (1). 准备工作</p><p>创建一个目录， 如<code>MyAPP</code>，自定义程序的安装路径为<code>/usr/src</code>（文件默认是释放到根目录下），并将之前生成的发布文件夹复制到<code>MyAPP/usr/src</code>下。</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> MyAPP</span><br><span class="line"><span class="built_in">cd</span> MyAPP</span><br><span class="line"><span class="built_in">mkdir</span> -p usr/src</span><br><span class="line">cp -a ~/AppFolder usr/src</span><br></pre></td></tr></table></figure><blockquote><p>注意：<code>desktop</code>文件中 <code>Exec</code> 和 <code>Icon</code> 必须要是<strong>绝对路径</strong>！</p></blockquote><p>(2). DEBIAN</p><p>在<code>MyAPP</code>下创建一个目录<code>DEBIAN</code>，在<code>DEBIAN</code>下创建一个<code>control</code>文件，并编写以下内容：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir DEBIAN</span><br><span class="line">cd DEBIAN</span><br><span class="line">vim control</span><br></pre></td></tr></table></figure><p>control</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">package: MyAPP</span><br><span class="line">Version: 1.0.1</span><br><span class="line">Section: utils</span><br><span class="line">Priority: optional</span><br><span class="line">Architecture: amd64</span><br><span class="line">Depends:</span><br><span class="line">Installed-Size: 4096</span><br><span class="line">Maintainer: Smith</span><br><span class="line">Description: MyAPP-deb</span><br></pre></td></tr></table></figure><p>postinst</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line">chmod 777 /usr/src/MyAPP/MyAPP.desktop</span><br><span class="line">cp /usr/src/MyAPP/MyAPP.desktop /usr/share/applications/</span><br><span class="line">cp /usr/src/MyAPP/MyAPP.desktop ~/桌面/</span><br></pre></td></tr></table></figure><p>postrm</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line">rm /usr/share/applications/MyAPP.desktop</span><br><span class="line">rm ~/桌面/MyAPP.desktop</span><br></pre></td></tr></table></figure><p>(3). 构建生成deb包</p><p>执行<code>dpkg -b . MyAPP.0.1_amd64.deb</code>，生成<code>deb</code>包，可以指定<code>deb</code>包的生成路径。</p><p>(4). 安装deb包</p><p>执行<code>dpkg -i MyAPP.0.1_amd64.deb</code>后，在<code>/usr/src</code>中会多出一个<code>MyAPP</code>目录，执行其中即可</p><p>(5). 卸载deb包</p><p><code>dpkg -r MyAPP</code></p><blockquote><p>安装失败时，重新安装会发生的问题：</p><p>问题一：子进程 xxx 已安装 pre-removal 脚本 返回了错误号 1 或 2 </p><p>解决方案：打开<code>gedit /var/lib/dpkg/status</code>,找到<code>Package: 包名</code>，将那一部分删除即可。</p></blockquote><h2 id="5-deb"><a href="#5-deb" class="headerlink" title="5. deb"></a>5. deb</h2><p>假设可程序程序名为<code>MCPlayer</code></p><p>用<code>dpkg</code>打包之前，需要将程序的安装路径<code>映射</code>到软件包的主目录下。</p><ul><li>如创建一个目录<code>MCPlayerDeb</code>，作为软件包的主目录；</li><li>假设要安装到目标计算机的<code>/opt</code>目录中，就需要在<code>MCPlayerDeb</code>下创建对应目录，如<code>PlayerDeb/opt</code>；</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Deb-MCPlayer/</span><br><span class="line">├── DEBIAN# 存放配置文件（control）和 多个脚本文件</span><br><span class="line">│   ├── control# 配置文件：编写配置信息</span><br><span class="line">│   ├── preinst# 脚本文件：安装时执行</span><br><span class="line">│   ├── postinst# 脚本文件：安装后执行</span><br><span class="line">│   └── prerm# 脚本文件：卸载时执行</span><br><span class="line">│   ├── postrm# 脚本文件：卸载后执行</span><br><span class="line">├── opt# 安装包目录（相对于系统的路径）</span><br><span class="line">│   └── MCPlayer</span><br><span class="line">│       ├── MCPlayer# 可执行文件</span><br><span class="line">│       └── ...# 其它文件（如lib、plugins等）</span><br><span class="line">└── usr</span><br><span class="line">    └── share</span><br><span class="line">        ├── applications</span><br><span class="line">        │   └── MCPlayer.desktop# 开始菜单快捷方式</span><br><span class="line">        └── icons# 图标</span><br><span class="line">            └── hicolor</span><br><span class="line">                ├── 16x16</span><br><span class="line">                │   └── apps</span><br><span class="line">                │       └── MCPlayer.png</span><br><span class="line">                ├── 24x24</span><br><span class="line">                │   └── apps</span><br><span class="line">                │       └── MCPlayer.png</span><br><span class="line">                ├── ...</span><br></pre></td></tr></table></figure><h3 id="配置文件-control"><a href="#配置文件-control" class="headerlink" title="配置文件 control"></a>配置文件 control</h3><p>control文件在打包时需要调用，control文件的基本配置项如下：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Package: Player<span class="comment"># 软件包名称</span></span><br><span class="line">Version: 1.0.0<span class="comment"># 软件包版本</span></span><br><span class="line">Description: This is a player deb package<span class="comment"># 软件包描述</span></span><br><span class="line">Maintainer: WonderThink<span class="comment"># 著作人信息（名称，联系方式，邮箱等）</span></span><br><span class="line">Architecture: amd64<span class="comment"># 软件包支持的架构平台（i386/amd64,m64k,sparc,alpha,powerpc,...）</span></span><br><span class="line">Section: utils<span class="comment"># 软件包类别（utils,net,mail,text,x11,...）</span></span><br><span class="line">Source:<span class="comment"># 软件包的源代码名称</span></span><br><span class="line">Priority: optional<span class="comment"># 软件包对系统的优先级（required,standard,optional,extra,...）</span></span><br><span class="line">Installed_Size: 4096</span><br><span class="line">Depends:<span class="comment"># 软件依赖的其他软件包和库文件（多个用逗号隔开）</span></span><br><span class="line">Pre-Depends:<span class="comment"># 软件安装前必须安装或依赖的软件包和库文件</span></span><br><span class="line">Recommends:<span class="comment"># 推荐安装的其他软件包和库文件</span></span><br><span class="line">Suggests:<span class="comment"># 建议安装的其他软件包和库文</span></span><br></pre></td></tr></table></figure><p>在本例中，基本配置如下：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Package: MCPlayer</span><br><span class="line">Version: 1.0.1.0</span><br><span class="line">Section: free</span><br><span class="line">Priority: optional</span><br><span class="line">Installed-Size: 4096</span><br><span class="line">Architecture: arm64</span><br><span class="line">Homepage: https://www.mcplayerdemo.com</span><br><span class="line">Maintainer: help@mcplayerdemo.com</span><br><span class="line">Description: mc player applcation.</span><br></pre></td></tr></table></figure><h3 id="脚本文件-preinst"><a href="#脚本文件-preinst" class="headerlink" title="脚本文件 preinst"></a>脚本文件 preinst</h3><p><code>preinst</code>脚本在安装应用时执行。该脚本一般用来停止旧应用程序，更新应用配置，创建自定义服务等。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/sh</span></span><br><span class="line"></span><br><span class="line">PACK_NAME=MCPlayer</span><br><span class="line">INSTALL_PATH=/opt/$&#123;PACK_NAME&#125;</span><br><span class="line">DESKTOP_FILE_PATH=$&#123;INSTALL_PATH&#125;/$&#123;PACK_NAME&#125;.desktop</span><br><span class="line">DESKTOP_PATH=$(xdg-user-dir DESKTOP)# 使用 xdg-user-dir 获取桌面目录路径，确保跨语言环境兼容</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">kill</span> old version</span></span><br><span class="line">killall mcplayer &gt; /dev/null 2&gt;&amp;1 || true</span><br><span class="line">killall -9 MCPlayer &gt; /dev/null 2&gt;&amp;1 || true</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cp</span> service file to systemd</span></span><br><span class="line">SERVICE_NAME=mcplayerd.service</span><br><span class="line">SERVICE_PATH=$&#123;INSTALL_PATH&#125;/$&#123;SERVICE_NAME&#125;</span><br><span class="line"></span><br><span class="line">if [ ! -f &quot;$SERVICE_PATH&quot; ]; then</span><br><span class="line">    echo &quot;service file is not found.&quot;</span><br><span class="line">    exit 1</span><br><span class="line">fi</span><br><span class="line">cp &quot;$SERVICE_PATH&quot; /etc/systemd/system/</span><br><span class="line">if [ $? -ne 0 ]; then</span><br><span class="line">    echo &quot;can&#x27;t copy service file to systemd.&quot;</span><br><span class="line">    exit 1</span><br><span class="line">fi</span><br><span class="line">echo &quot;create service file success.&quot;</span><br></pre></td></tr></table></figure><h3 id="脚本文件-postinst"><a href="#脚本文件-postinst" class="headerlink" title="脚本文件 postinst"></a>脚本文件 postinst</h3><p><code>postinst</code>脚本在卸载应用后执行。该脚本一般用来创建快捷方式，启动自定义服务等。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/sh</span></span><br><span class="line"></span><br><span class="line">PACK_NAME=MCPlayer</span><br><span class="line">INSTALL_PATH=/opt/$&#123;PACK_NAME&#125;</span><br><span class="line">DESKTOP_FILE_PATH=$&#123;INSTALL_PATH&#125;/$&#123;PACK_NAME&#125;.desktop</span><br><span class="line">DESKTOP_PATH=$(xdg-user-dir DESKTOP)# 使用 xdg-user-dir 获取桌面目录路径，确保跨语言环境兼容</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">create desktop file</span></span><br><span class="line">if [ ! -d &quot;$DESKTOP_FILE_PATH&quot; ]; then</span><br><span class="line">    echo &quot;desktop file is not found.&quot;</span><br><span class="line">    exit 1</span><br><span class="line">fi</span><br><span class="line">cp &quot;$DESKTOP_FILE_PATH&quot; &quot;$DESKTOP_PATH/&quot;</span><br><span class="line">if [ $? -ne 0 ]; then</span><br><span class="line">    echo &quot;can&#x27;t copy desktop file to systemd.&quot;</span><br><span class="line">    exit 1</span><br><span class="line">fi</span><br><span class="line">echo &quot;create desktop file success.&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">run service</span></span><br><span class="line">SERVICE_NAME=mcplayerd.service</span><br><span class="line">systemctl --system daemon-reload</span><br><span class="line">systemctl enable &quot;$SERVICE_NAME&quot;</span><br><span class="line">systemctl start &quot;$SERVICE_NAME&quot;</span><br></pre></td></tr></table></figure><h3 id="脚本文件-prerm"><a href="#脚本文件-prerm" class="headerlink" title="脚本文件 prerm"></a>脚本文件 prerm</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">killall -9 MCPlayer &gt; /dev/null 2&gt;&amp;1 || true</span><br><span class="line"></span><br><span class="line">systemctl stop mcplayerd.service</span><br><span class="line">systemctl disable mcplayerd.service</span><br></pre></td></tr></table></figure><h3 id="脚本文件-postrm"><a href="#脚本文件-postrm" class="headerlink" title="脚本文件 postrm"></a>脚本文件 postrm</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/sh</span></span><br><span class="line"></span><br><span class="line">PACK_NAME=MCPlayer</span><br><span class="line">INSTALL_PATH=/opt/$&#123;PACK_NAME&#125;</span><br><span class="line"></span><br><span class="line">DESKTOP_PATH=$(xdg-user-dir DESKTOP)# 使用 xdg-user-dir 获取桌面目录路径，确保跨语言环境兼容</span><br><span class="line">DESKTOP_FILE_PATH=$&#123;DESKTOP_PATH&#125;/$&#123;PACK_NAME&#125;.desktop</span><br><span class="line">APP_FILE_PATH=/usr/share/applications/$&#123;PACK_NAME&#125;.desktop</span><br><span class="line"></span><br><span class="line">SERVICE_NAME=&quot;mcplayerd.service&quot;</span><br><span class="line">SERVICE_FILE=&quot;/etc/systemd/system/$SERVICE_NAME&quot;</span><br><span class="line"></span><br><span class="line">if [ -f &quot;$DESKTOP_FILE_PATH&quot; ]; then</span><br><span class="line">    rm &quot;$DESKTOP_FILE_PATH&quot;</span><br><span class="line">    echo &quot;desktop file is deleted.&quot;</span><br><span class="line">else</span><br><span class="line">    echo &quot;desktop file is not found. do next step.&quot;</span><br><span class="line">fi</span><br><span class="line">if [ -f &quot;$APP_FILE_PATH&quot; ]; then</span><br><span class="line">    rm &quot;$APP_FILE_PATH&quot;</span><br><span class="line">    echo &quot;application desktop file is deleted.&quot;</span><br><span class="line">else</span><br><span class="line">    echo &quot;application desktop file is not found. do next step.&quot;</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">检查服务是否存在</span></span><br><span class="line">if systemctl list-unit-files | grep -q &quot;^$SERVICE_NAME&quot;; then</span><br><span class="line">    # 如果服务正在运行，则停止它</span><br><span class="line">    if systemctl is-active --quiet &quot;$SERVICE_NAME&quot;; then</span><br><span class="line">        systemctl stop &quot;$SERVICE_NAME&quot;</span><br><span class="line">        echo &quot;服务 $SERVICE_NAME 已停止&quot;</span><br><span class="line">    fi</span><br><span class="line"></span><br><span class="line">    # 禁用服务，防止它在开机时启动</span><br><span class="line">    systemctl disable &quot;$SERVICE_NAME&quot;</span><br><span class="line">    echo &quot;服务 $SERVICE_NAME 已禁用&quot;</span><br><span class="line"></span><br><span class="line">    # 刷新 systemd 配置</span><br><span class="line">    systemctl --system daemon-reload</span><br><span class="line"></span><br><span class="line">    # 删除服务文件</span><br><span class="line">    if [ -f &quot;$SERVICE_FILE&quot; ]; then</span><br><span class="line">        rm &quot;$SERVICE_FILE&quot;</span><br><span class="line">        echo &quot;服务文件 $SERVICE_FILE 已删除&quot;</span><br><span class="line">    else</span><br><span class="line">        echo &quot;警告: 服务文件 $SERVICE_FILE 不存在，跳过删除步骤&quot;</span><br><span class="line">    fi</span><br><span class="line">else</span><br><span class="line">    echo &quot;警告: 服务 $SERVICE_NAME 未找到，跳过停止、禁用和删除步骤&quot;</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重新加载 systemd 配置</span></span><br><span class="line">systemctl --system daemon-reload</span><br></pre></td></tr></table></figure><h3 id="桌面文件-MCPlayer-desktop"><a href="#桌面文件-MCPlayer-desktop" class="headerlink" title="桌面文件 MCPlayer.desktop"></a>桌面文件 MCPlayer.desktop</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Desktop Entry]</span></span><br><span class="line"><span class="attr">Name</span>=Player<span class="comment"># 程序名称</span></span><br><span class="line">Version: 1.0.0<span class="comment"># 程序版本号</span></span><br><span class="line">Comment: This is a player deb package<span class="comment"># 程序注释</span></span><br><span class="line"><span class="attr">Type</span>=Application<span class="comment"># 程序类型</span></span><br><span class="line"><span class="attr">Exec</span>=/usr/bin/Player<span class="comment"># 指定程序存放的路径</span></span><br><span class="line"><span class="attr">Icon</span>=/usr/share/Player/Player.png<span class="comment"># 指定图标存放的路径</span></span><br><span class="line"><span class="attr">Terminal</span>=<span class="literal">false</span><span class="comment"># 是否打开程序时同时打开终端</span></span><br></pre></td></tr></table></figure><blockquote><p>注：若没有将icon放到&#x2F;usr&#x2F;share&#x2F;applications&#x2F;目录下，则需要写全路径。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 查看服务日志</span><br><span class="line">journalctl -u dsmsprinterd</span><br><span class="line">// 删除服务日志</span><br><span class="line">journalctl --rotate</span><br><span class="line">journalctl --vacuum-time=1s -u dsmsprinterd</span><br><span class="line"></span><br><span class="line">systemctl --system daemon-reload</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><script src="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/js/lightgallery.min.js"></script><script>if("undefined"!=typeof lightGallery) {        var options1 = {            selector: '.gallery-item'        };        lightGallery(document.getElementsByClassName('.article-gallery')[0], options1);        }</script>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/07/04/lambda%E8%A1%A8%E8%BE%BE%E5%BC%8F/"/>
      <url>/2024/07/04/lambda%E8%A1%A8%E8%BE%BE%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/lightgallery.min.css" /><div class=".article-gallery"><h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><p><code>Lambda</code>表达式，是<code>C++11</code>的一个重要特性；<br>它可以用来创建<code>匿名函数</code>，并可以作为<code>函数对象</code>来使用，以替代繁琐的函数声明和定义。</p><h1 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">[capture list] (parameters) <span class="function"><span class="keyword">mutable</span> <span class="title">throw</span><span class="params">()</span> -&gt; <span class="keyword">return</span>-type </span>&#123; statement &#125;;</span><br><span class="line"></span><br><span class="line">[捕获列表] (参数列表) 可变规则 异常说明() -&gt; 返回类型 &#123; 函数体 &#125;</span><br></pre></td></tr></table></figure><h2 id="capture-list"><a href="#capture-list" class="headerlink" title="capture list"></a>capture list</h2><p>捕获列表，可以捕获当前函数作用域中的一个或多个局部变量（变量之间使用逗号隔开），在函数体中，可以访问或修改这些局部变量。<br>捕获方式分为3种：</p><ul><li><code>值捕获</code><ul><li>将局部变量以<code>const引用</code>形式传递到Lambda中，即Lambda<code>可以访问但无法修改</code>这些变量。</li><li>使用<code>=</code>可以将所有局部变量以<code>值捕获</code>形式传入到表达式中。<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a = <span class="number">1</span>, b = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">auto</span> func1 = [a, b] &#123; <span class="keyword">return</span> a + b; &#125;;</span><br><span class="line"><span class="keyword">auto</span> func2 = [=] &#123; <span class="keyword">return</span> a + b; &#125;;</span><br><span class="line"><span class="type">int</span> res1 = <span class="built_in">func1</span>();</span><br><span class="line"><span class="type">int</span> res2 = <span class="built_in">func1</span>();</span><br></pre></td></tr></table></figure></li></ul></li><li><code>引用捕获</code><ul><li>将局部变量以<code>引用</code>形式传递到Lambda中，即Lambda<code>可以访问也可以修改</code>这些变量。</li><li>使用<code>&amp;</code>可以将所有局部变量以<code>引用捕获</code>形式传入到Lambda表达式中。<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a = <span class="number">1</span>, b = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">auto</span> func1 = [&amp;a, &amp;b] &#123; a++; <span class="keyword">return</span> a + b; &#125;;</span><br><span class="line"><span class="keyword">auto</span> func2 = [&amp;] &#123; b++; <span class="keyword">return</span> a + b; &#125;;</span><br><span class="line"><span class="type">int</span> res1 = <span class="built_in">func1</span>();</span><br><span class="line"><span class="type">int</span> res2 = <span class="built_in">func2</span>();</span><br></pre></td></tr></table></figure></li></ul></li><li><code>混合捕获</code><ul><li>捕获列表中，既有<code>值捕获</code>的变量，也有<code>引用捕获</code>的变量。<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a = <span class="number">1</span>, b = <span class="number">2</span>, c = <span class="number">3</span>, d = <span class="number">4</span>;</span><br><span class="line"><span class="keyword">auto</span> func1 = [=, &amp;a] &#123; a++; <span class="keyword">return</span> a + b + c;&#125; ;</span><br><span class="line"><span class="keyword">auto</span> func2 = [=, &amp;b, &amp;c] &#123; b++; c++; <span class="keyword">return</span> a + b + c; &#125;;</span><br><span class="line"><span class="keyword">auto</span> func3 = [&amp;, a, b] &#123; c++; <span class="keyword">return</span> a + b + c; &#125;;</span><br><span class="line"><span class="type">int</span> res1 = <span class="built_in">func1</span>();</span><br><span class="line"><span class="type">int</span> res2 = <span class="built_in">func2</span>();</span><br></pre></td></tr></table></figure></li></ul></li><li>其他捕获<ul><li><code>[]</code>：什么都不捕获；</li><li><code>[this]</code>：捕获<code>this</code>指针，<code>=</code> 和 <code>&amp;</code> 也能捕获this指针；</li></ul></li></ul><h2 id="参数列表"><a href="#参数列表" class="headerlink" title="参数列表"></a>参数列表</h2><p>Lambda可以传递捕获列表，也可以传递参数列表，用法和普通函数一致。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> func = [](<span class="type">int</span> a, <span class="type">int</span> b) &#123; <span class="keyword">return</span> a + b; &#125;;</span><br><span class="line"><span class="type">int</span> res = <span class="built_in">func</span>(<span class="number">10</span>, <span class="number">20</span>);</span><br></pre></td></tr></table></figure><h2 id="限定符-mutable"><a href="#限定符-mutable" class="headerlink" title="限定符 mutable"></a>限定符 mutable</h2><p>限定符mutable，可以使Lambda在函数体内修改<code>值捕获</code>的变量；</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> f1 = [a]() &#123;a++;&#125;;         <span class="comment">// error</span></span><br><span class="line"><span class="keyword">auto</span> f2 = [a]() <span class="keyword">mutable</span> &#123;a++;&#125;;</span><br></pre></td></tr></table></figure><h2 id="异常说明符-noexcept"><a href="#异常说明符-noexcept" class="headerlink" title="异常说明符 noexcept"></a>异常说明符 noexcept</h2><p>异常说明符noexcept，指定了Lambda不会抛出异常；</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><h2 id="返回值类型-type"><a href="#返回值类型-type" class="headerlink" title="返回值类型 -&gt;type"></a>返回值类型 -&gt;type</h2></div><script src="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/js/lightgallery.min.js"></script><script>if("undefined"!=typeof lightGallery) {        var options1 = {            selector: '.gallery-item'        };        lightGallery(document.getElementsByClassName('.article-gallery')[0], options1);        }</script>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/07/04/%E9%93%B6%E6%B2%B3%E9%BA%92%E9%BA%9FV10-%E6%8C%87%E4%BB%A4%E6%B1%87%E6%80%BB/"/>
      <url>/2024/07/04/%E9%93%B6%E6%B2%B3%E9%BA%92%E9%BA%9FV10-%E6%8C%87%E4%BB%A4%E6%B1%87%E6%80%BB/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/lightgallery.min.css" /><div class=".article-gallery"><h2 id="首次安装：修改root密码"><a href="#首次安装：修改root密码" class="headerlink" title="首次安装：修改root密码"></a>首次安装：修改root密码</h2><p>终端输入<code>sudo passwd root</code>，旧密码就是登录系统的密码，而后设置新密码即可。</p><h2 id="设置默认为root用户"><a href="#设置默认为root用户" class="headerlink" title="设置默认为root用户"></a>设置默认为root用户</h2><p>终端输入<code>sudo vim /etc/lightdm/lightdm.conf</code>，修改<code>autologin-user</code>为<code>root</code>，保存后重启系统即可。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[SeatDefaults]</span><br><span class="line">autologin-guest=false</span><br><span class="line">autologin-user=root</span><br><span class="line">autologin-user-timeout=0</span><br></pre></td></tr></table></figure><h2 id="安装QTCreator"><a href="#安装QTCreator" class="headerlink" title="安装QTCreator"></a>安装QTCreator</h2><p>下载QT：<code>https://download.qt.io/archive/qt/</code>，进入对应版本的文件夹中，下载<code>.run</code>后缀的文件，如<code>qt-opensource-linux-x64-5.14.2.run</code><br>输入<code>./qt-opensource-linux-x64-5.14.2.run</code>安装（提前断网，可以跳过账户验证）</p></div><script src="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/js/lightgallery.min.js"></script><script>if("undefined"!=typeof lightGallery) {        var options1 = {            selector: '.gallery-item'        };        lightGallery(document.getElementsByClassName('.article-gallery')[0], options1);        }</script>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/07/04/%E9%93%B6%E6%B2%B3%E9%BA%92%E9%BA%9FV10%20%E6%89%93%E5%8D%B0%E6%9C%BA/"/>
      <url>/2024/07/04/%E9%93%B6%E6%B2%B3%E9%BA%92%E9%BA%9FV10%20%E6%89%93%E5%8D%B0%E6%9C%BA/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/lightgallery.min.css" /><div class=".article-gallery"><p><code>ldq</code>:查看打印机列表<br>若显示打印进行中，需执行<code>ldadmin -x dsms</code>,删除打印机。重启电脑后，再添加。</p></div><script src="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/js/lightgallery.min.js"></script><script>if("undefined"!=typeof lightGallery) {        var options1 = {            selector: '.gallery-item'        };        lightGallery(document.getElementsByClassName('.article-gallery')[0], options1);        }</script>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/07/04/%E9%9F%B3%E8%A7%86%E9%A2%91-%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/"/>
      <url>/2024/07/04/%E9%9F%B3%E8%A7%86%E9%A2%91-%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/lightgallery.min.css" /><div class=".article-gallery"><h2 id="I帧-P帧-B帧"><a href="#I帧-P帧-B帧" class="headerlink" title="I帧 P帧 B帧"></a>I帧 P帧 B帧</h2><p><code>I帧</code>：intra-coded picture，帧内编码帧，I帧通常是每个GOP的第一个帧，经过适度压缩，作为随机访问的参考点，可作为图像，即I帧可看作是一个图像经过压缩后的产物。</p><p><code>P帧</code>：predictive-frame，前向预测编码帧（预测帧），通过充分将低于图像序列中前面</p></div><script src="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/js/lightgallery.min.js"></script><script>if("undefined"!=typeof lightGallery) {        var options1 = {            selector: '.gallery-item'        };        lightGallery(document.getElementsByClassName('.article-gallery')[0], options1);        }</script>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2024/07/02/hello-world/"/>
      <url>/2024/07/02/hello-world/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" type="text/css" href="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/css/lightgallery.min.css" /><div class=".article-gallery"><p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p></div><script src="https://jsd.onmicrosoft.cn/npm/hexo-theme-a4@latest/source/js/lightgallery.min.js"></script><script>if("undefined"!=typeof lightGallery) {        var options1 = {            selector: '.gallery-item'        };        lightGallery(document.getElementsByClassName('.article-gallery')[0], options1);        }</script>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
